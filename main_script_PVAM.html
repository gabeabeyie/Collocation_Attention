<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>main_script_pvam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main_script_PVAM_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_script_PVAM_files/libs/quarto-html/quarto.js"></script>
<script src="main_script_PVAM_files/libs/quarto-html/popper.min.js"></script>
<script src="main_script_PVAM_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_script_PVAM_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_script_PVAM_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_script_PVAM_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_script_PVAM_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_script_PVAM_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_script_PVAM_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<pre><code>TOPIC: Beyond News Headlines and TF-IDF: Enhancing Text-Based Forecasting Models with Validated Collocations and Improved Attention.
Author : Gabriel Appau Abeyie.

Explanation for Code Block 1:</code></pre>
<p>This code block is dedicated to importing the necessary libraries and modules needed for our research. Below is a brief description of some of the important imports:</p>
<p><strong>nltk</strong>: This library is used for working with human language data. It provides easy-to-use interfaces to over 50 corpora and lexical resources.</p>
<p><strong>numpy</strong> and <strong>pandas</strong>: These libraries are used for handling and manipulating the dataset. numpy is used for mathematical calculations, and pandas is used for data manipulation and analysis.</p>
<p><strong>statsmodels</strong>: This library is used to estimate and interpret models for statistical analysis.</p>
<p><strong>matplotlib</strong>: This library is used for plotting and visualization of the data.</p>
<p><strong>scikit-learn (sklearn)</strong>: This library is used for machine learning and statistical modeling. It provides various tools for model fitting, data preprocessing, model selection and evaluation, and many other utilities.</p>
<p><strong>scipy</strong>: This library is used for scientific and technical computing. It provides functions for mathematical operations, statistical analysis, and more.</p>
<p><strong>wordcloud</strong>: This library is used for visualizing word frequency by generating word clouds.</p>
<p><strong>arabica</strong>: This library is used for exploratory text data analaysis.</p>
<p><strong>yfinance</strong>: This library is used to fetch financial data.</p>
<p><strong>fredapi</strong>: This library is used for accessing economic data from the Federal Reserve Economic Data (FRED) database.</p>
<p><strong>NOTE</strong>: The code block also sets up fredapi with an API key (placeholder is given as ‘YOUR_FRED_API_KEY_HERE’) and overrides pandas’ datareader methods to use yfinance instead, which is used for downloading historical market data from Yahoo! Finance.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk <span class="im">import</span> ngrams</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> ElasticNetCV</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> TimeSeriesSplit</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> f_regression</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2_contingency</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem <span class="im">import</span> WordNetLemmatizer</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> wordnet</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'wordnet'</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ttest_1samp</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.ar_model <span class="im">import</span> AutoReg</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Rectangle</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arabica <span class="im">import</span> arabica_freq</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud, STOPWORDS</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dieboldmariano <span class="im">import</span> dm_test</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arabica <span class="im">import</span> cappuccino</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arabica <span class="im">import</span> coffee_break</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> sent_tokenize</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> wordnet</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk <span class="im">import</span> pos_tag</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk <span class="im">import</span> ne_chunk</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.util <span class="im">import</span> ngrams</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.porter <span class="im">import</span> PorterStemmer</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.wordnet <span class="im">import</span> WordNetLemmatizer</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.probability <span class="im">import</span> FreqDist</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer, TfidfVectorizer</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas_datareader <span class="im">import</span> data <span class="im">as</span> pdr</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fredapi <span class="im">import</span> Fred</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>fred <span class="op">=</span> <span class="st">'YOUR_FRED_API_KEY_HERE'</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>yf.pdr_override()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 2:</code></pre>
<p>This block of code is focused on retrieving and processing the oil price data. The data is retrieved from FRED</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>oil_price <span class="op">=</span> fred.get_series(<span class="st">'DCOILWTICO'</span>, observation_start<span class="op">=</span><span class="st">'1986-01-01'</span>, observation_end<span class="op">=</span><span class="st">'2017-12-01'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>monthly_oil <span class="op">=</span> oil_price.resample(<span class="st">'M'</span>).mean().ffill()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>monthly_oil_log <span class="op">=</span> np.log(monthly_oil)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>monthly_oil_log_diff <span class="op">=</span> monthly_oil_log.diff()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>monthly_oil_log_diff <span class="op">=</span> monthly_oil_log_diff.dropna()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_oil_log_diff.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1986-02-28   -0.394332
1986-03-31   -0.203227
1986-04-30    0.018160
1986-05-31    0.180065
1986-06-30   -0.135741
Freq: M, dtype: float64</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 3:</code></pre>
<p>This block of code is used for visualizing the monthly log differences in oil prices along with the periods of recessions in the U.S.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>recessions <span class="op">=</span> fred.get_series(<span class="st">'USREC'</span>, observation_start<span class="op">=</span><span class="st">'1986-01-01'</span>, observation_end<span class="op">=</span><span class="st">'2017-12-01'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>recessions <span class="op">=</span> recessions.resample(<span class="st">'M'</span>).last().ffill()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.plot(monthly_oil_log_diff, label<span class="op">=</span><span class="st">'Monthly log differences of oil prices'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start, end <span class="kw">in</span> <span class="bu">zip</span>(recessions.index[recessions.diff() <span class="op">==</span> <span class="dv">1</span>], recessions.index[recessions.diff() <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    plt.axvspan(start, end, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Log Difference'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'target.eps'</span>, dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="main_script_PVAM_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<pre><code>Explanation for Code Block 4:</code></pre>
<p>This code block is focused on retrieving and processing the Sahm Rule Recession Indicator, a real-time recession indicator based on unemployment data.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Sahm Rule Recession Indicator</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sahn_index <span class="op">=</span> fred.get_series(<span class="st">'SAHMREALTIME'</span>, observation_start<span class="op">=</span><span class="st">'1986-02-01'</span>, observation_end<span class="op">=</span><span class="st">'2017-12-01'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize recession_expansion and update as matrices of True</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>recession_expansion <span class="op">=</span> pd.DataFrame(<span class="va">True</span>, index<span class="op">=</span>sahn_index.index, columns<span class="op">=</span>[<span class="st">'indicator'</span>])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>update <span class="op">=</span> recession_expansion.copy()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Update recession_expansion: set to False if Sahm Rule Recession Indicator &gt; 0.5</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>recession_expansion.loc[sahn_index <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="st">'indicator'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the update matrix: set to True only for the first time point and whenever the value of recession_expansion changes</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>update[<span class="st">'indicator'</span>] <span class="op">=</span> recession_expansion[<span class="st">'indicator'</span>].ne(recession_expansion[<span class="st">'indicator'</span>].shift())</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>update[<span class="st">'indicator'</span>].iloc[<span class="dv">0</span>] <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 5:</code></pre>
<p>This block of code is concerned with loading datasets and preparing the target variable for further analysis.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Features <span class="op">=</span> pd.read_csv(<span class="st">'D:/Python/Untitled Folder/df1.csv'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>FREDMD <span class="op">=</span> pd.read_csv(<span class="st">'D:/Python/Untitled Folder/fredmd.csv'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>NewsHeadlines <span class="op">=</span> pd.read_csv(<span class="st">'D:/Python/Untitled Folder/NewHeadlines.csv'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Target <span class="op">=</span> monthly_oil_log_diff.values.ravel()  <span class="co"># This converts the target DataFrame to a 1D array</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 6:</code></pre>
<p>This block of code is dedicated to text cleaning by correcting specific word forms in the Features DataFrame. The objective is to ensure that the text data is consistent and free from certain types of errors or variations.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates a dictionary mapping the incorrect forms to the correct ones</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>correction_dict <span class="op">=</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"accord ing"</span>: <span class="st">"according"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interna tional"</span>: <span class="st">"international"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"administra tion"</span>: <span class="st">"administration"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"air line"</span>: <span class="st">"airline"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bar rel"</span>: <span class="st">"barrel"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invest ment"</span>: <span class="st">"investment"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bil lion"</span>: <span class="st">"billion"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mil lion"</span>: <span class="st">"million"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com pared"</span>: <span class="st">"compared"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com modities"</span>:<span class="st">"commodity"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"commod ity"</span>: <span class="st">"commodity"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"expecta tions"</span>: <span class="st">"expectation"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"percent age"</span>: <span class="st">"percentage"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yorkcrude"</span>: <span class="st">"york crude"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ear lier"</span>: <span class="st">"earlier"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"earn ings"</span>: <span class="st">"earnings"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"econo mist"</span>: <span class="st">"economist"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"euro pean"</span>: <span class="st">"european"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bar rels"</span>: <span class="st">"barrel"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pro ducer"</span>: <span class="st">"producer"</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pro ducers"</span>: <span class="st">"producer"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pro gram"</span>: <span class="st">"program"</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prob lem"</span>: <span class="st">"problem"</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pro duction"</span>: <span class="st">"production"</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"daq"</span>: <span class="st">"nasdaq"</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nasnasnasdaq"</span>: <span class="st">"nasdaq"</span>,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fri day"</span>: <span class="st">"friday"</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fourth quarter"</span>: <span class="st">"fourthquarter"</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prod ucts"</span>: <span class="st">"product"</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quar ter"</span>: <span class="st">"quarter"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chi cago"</span>: <span class="st">"chicago"</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ri ing"</span>: <span class="st">"rising"</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sec ond"</span>: <span class="st">"second"</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sec tor"</span>: <span class="st">"sector"</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"securi ties"</span>: <span class="st">"securitie"</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"securi tie"</span>: <span class="st">"securitie"</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"execu tive"</span>: <span class="st">"executive"</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invest ment"</span>: <span class="st">"investment"</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"decem ber"</span>: <span class="st">"december"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"janu ary"</span>: <span class="st">"january"</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mar ket"</span>: <span class="st">"market"</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sev eral"</span>: <span class="st">"several"</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"inven tory"</span>: <span class="st">"inventory"</span>,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sell ing"</span>: <span class="st">"selling"</span>,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"trad er"</span>: <span class="st">"trader"</span>,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"trad ing"</span>: <span class="st">"trading"</span>,</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vol ume"</span>: <span class="st">"volume"</span>,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"trea sury"</span>: <span class="st">"treasury"</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invento ries"</span>: <span class="st">"inventory"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"inves tor"</span>: <span class="st">"investor"</span>,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"web site"</span>: <span class="st">"website"</span>,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invest ment"</span>: <span class="st">"investment"</span>,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invest ments"</span>: <span class="st">"investment"</span>,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yester day"</span>: <span class="st">"yesterday"</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yes terday"</span>: <span class="st">"yesterday"</span>,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wednes day"</span>: <span class="st">"wednesday"</span>,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mer cantile"</span>: <span class="st">"mercantile"</span>,</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mercan tile"</span>: <span class="st">"mercantile"</span>,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tues day"</span>: <span class="st">"tuesday"</span>,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mil lion"</span>: <span class="st">"million"</span>,</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"novem ber"</span>: <span class="st">"november"</span>,</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sum mer"</span>: <span class="st">"summer"</span>,</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stockindex"</span>: <span class="st">"stock index"</span>,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"washingtonpost"</span>: <span class="st">"washington post"</span>,</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"contin ued"</span>: <span class="st">"continued"</span>,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"crudeoil"</span>: <span class="st">"crude oil"</span>,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nasnasdaq"</span>: <span class="st">"nasdaq"</span>,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"minuteminute"</span>: <span class="st">"minute minute"</span>,</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"futuresoptions"</span>: <span class="st">"future option"</span>,</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">"includ ing"</span>: <span class="st">"including"</span>,</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">"inter national"</span>: <span class="st">"international"</span>,</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"naturalgas"</span>: <span class="st">"natural gas"</span>,</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"oilbarrel"</span>: <span class="st">"oil barrel"</span>,</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outnum bered"</span>: <span class="st">"outnumbered"</span>,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pres sure"</span>: <span class="st">"pressure"</span>,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"presi dent"</span>: <span class="st">"president"</span>,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"terest"</span>: <span class="st">"interest"</span>,</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"thur day"</span>: <span class="st">"thursday"</span>,</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sup ply"</span>: <span class="st">"supply"</span>,</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"soy bean"</span>: <span class="st">"soybean"</span>,</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"inininterest"</span>: <span class="st">"interest"</span>,</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ininterest"</span>: <span class="st">"interest"</span>,</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fore cast"</span>: <span class="st">"forecast"</span>,</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">"reve nue"</span>: <span class="st">"revenue"</span>,</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">"peo ple"</span>: <span class="st">"people"</span>,</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aver age"</span>: <span class="st">"average"</span>,</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"petro leum"</span>: <span class="st">"petroleum"</span>,</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"organiza tion"</span>: <span class="st">"organization"</span>,</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pipe line"</span>: <span class="st">"pipeline"</span>,</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nat ural"</span>: <span class="st">"natural"</span>,</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ana lyst"</span>: <span class="st">"analyst"</span>,</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ana lysts"</span>: <span class="st">"analyst"</span>,</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buy ing"</span>: <span class="st">"buying"</span>,</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">"natu ral"</span>: <span class="st">"natural"</span>,</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    <span class="st">"busi ness"</span>: <span class="st">"business"</span>,</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chair man"</span>: <span class="st">"chairman"</span>,</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produc tion"</span>: <span class="st">"production"</span>,</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ex porting"</span>: <span class="st">"exporting"</span>,</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com panies"</span>: <span class="st">"company"</span>,</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ara bia"</span>: <span class="st">"arabia"</span>,</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">"larg est"</span>: <span class="st">"largest"</span>,</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mem bers"</span>: <span class="st">"member"</span>,</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mon day"</span>: <span class="st">"monday"</span>,</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com pany"</span>: <span class="st">"company"</span>,</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sep tember"</span>: <span class="st">"september"</span>,</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">"septem ber"</span>: <span class="st">"september"</span>,</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">"compa ny"</span>: <span class="st">"company"</span>,</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com modity"</span>: <span class="st">"commodity"</span>,</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ser vice"</span>: <span class="st">"service"</span>,</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ser vices"</span>: <span class="st">"service"</span>,</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>    <span class="st">"set tled"</span>: <span class="st">"settled"</span>,</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stan dard"</span>: <span class="st">"standard"</span>,</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>    <span class="st">"japa nese"</span>: <span class="st">"japanese"</span>,</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eco nomic"</span>: <span class="st">"economic"</span>,</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>    <span class="st">"commodi tie"</span>: <span class="st">"commodity"</span>,</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com posite"</span>: <span class="st">"composite"</span>,</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>    <span class="st">"compos ite"</span>: <span class="st">"composite"</span>,</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cur rency"</span>: <span class="st">"currency"</span>,</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cur rent"</span>: <span class="st">"current"</span>,</span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bench mark"</span>: <span class="st">"benchmark"</span>,</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coun try"</span>: <span class="st">"country"</span>,</span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fed eral"</span>: <span class="st">"federal"</span>,</span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>    <span class="st">"japa nese"</span>: <span class="st">"japanese"</span>,</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>    <span class="st">"export ing"</span>: <span class="st">"exporting"</span>,</span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deliv ery"</span>: <span class="st">"delivery"</span>,</span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">"depart ment"</span>: <span class="st">"department"</span>,</span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"heatingoil"</span>: <span class="st">"heating oil"</span>,</span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>    <span class="st">"heat ing"</span>: <span class="st">"heating"</span>,</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bluechip"</span>: <span class="st">"blue chip"</span>,</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>    <span class="st">"divi sion"</span>: <span class="st">"division"</span>,</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dol lar"</span>: <span class="st">"dollar"</span>,</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dur ing"</span>: <span class="st">"during"</span>,</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">"harmon"</span>: <span class="st">"harman"</span>,</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>    <span class="st">"inter est"</span>: <span class="st">"interest"</span>,</span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>    <span class="st">"econ omy"</span>: <span class="st">"economy"</span>,</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a>    <span class="st">"esti mate"</span>: <span class="st">"estimate"</span>,</span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>    <span class="st">"febru ary"</span>: <span class="st">"february"</span>,</span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>    <span class="st">"finan cial"</span>: <span class="st">"financial"</span>,</span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fur ther"</span>: <span class="st">"further"</span>,</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gal lon"</span>: <span class="st">"gallon"</span>,</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>    <span class="st">"investment officer albany"</span>: <span class="st">"investment officer first albany"</span>,</span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"point face yield"</span>: <span class="st">"face yield"</span>,</span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gaso line"</span>: <span class="st">"gasoline"</span>,</span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>    <span class="st">"glo bal"</span>: <span class="st">"global"</span>,</span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>    <span class="st">"second quarter"</span>: <span class="st">"secondquarter"</span>,</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smaller company"</span>: <span class="st">"smallercompany"</span>, </span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>    <span class="st">"govern ment"</span>: <span class="st">"government"</span>,</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gov ernment"</span>: <span class="st">"government"</span>,</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>    <span class="st">"include ing"</span>: <span class="st">"including"</span>,</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>    <span class="st">"indus trial"</span>: <span class="st">"industrial"</span>,</span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>    <span class="st">"indus try"</span>: <span class="st">"industry"</span>,</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>    <span class="st">"infla tion"</span>: <span class="st">"inflation"</span>,</span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>    <span class="st">"novem ber"</span>: <span class="st">"november"</span>,</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>    <span class="st">"octo ber"</span>: <span class="st">"october"</span>,</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>    <span class="st">"organi zation"</span>: <span class="st">"organization"</span>,</span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>    <span class="st">"offi cials"</span>: <span class="st">"official"</span>,</span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>    <span class="st">"manage ment"</span>: <span class="st">"management"</span>,</span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tech nology"</span>: <span class="st">"technology"</span>,</span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>    <span class="st">"big gest"</span>: <span class="st">"biggest"</span>,</span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>    <span class="st">"opera tions"</span>: <span class="st">"operation"</span>,</span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>    <span class="st">"insti tute"</span>: <span class="st">"institute"</span>,</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prec metal indus"</span>: <span class="st">"precious metal industry"</span>,</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>    <span class="st">"york stock change"</span>: <span class="st">"york stock exchange"</span>,</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mor gan"</span>: <span class="st">"morgan"</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to apply the corrections</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correct_words(text):</span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> incorrect, correct <span class="kw">in</span> correction_dict.items():</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> text.replace(incorrect, correct)</span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the function to your text column</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>Features[<span class="st">'cleaned_Text'</span>] <span class="op">=</span> Features[<span class="st">'cleaned_Text'</span>].<span class="bu">apply</span>(correct_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 7:</code></pre>
<p>This block of code is involved in preparing a corpus for further text analysis and generating date ranges for time-series analysis.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>corpus <span class="op">=</span> <span class="st">' '</span>.join(Features[<span class="st">'cleaned_Text'</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dates for x-axis</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>base_dates <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">"1986-01"</span>, end<span class="op">=</span><span class="st">"2017-12"</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>oos_base_dates <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">"2006-01"</span>, end<span class="op">=</span><span class="st">"2018-01"</span>, freq<span class="op">=</span><span class="st">'M'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 8:</code></pre>
<p>This code block defines a function for extracting n-grams from the text data and converting them into a numerical format suitable for machine learning models. The function also splits the data into training and testing sets and processes them separately to avoid data leakage.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ngramrange_df(df, min_df, tfidf_min, split_ratio, ngram_range):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data based on split ratio</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    split_index <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(df) <span class="op">*</span> split_ratio)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> df.iloc[:split_index]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    df_test <span class="op">=</span> df.iloc[split_index:]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an instance of the TfidfVectorizer class with specified ngram range</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    vectorizer_tfidf_combined <span class="op">=</span> TfidfVectorizer(analyzer<span class="op">=</span><span class="st">"word"</span>, ngram_range<span class="op">=</span>ngram_range, min_df<span class="op">=</span>min_df, stop_words<span class="op">=</span><span class="st">'english'</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the vectorizer on the training dataset and transform training dataset</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    X_tfidf_train <span class="op">=</span> vectorizer_tfidf_combined.fit_transform(df_train[<span class="st">'cleaned_Text'</span>])</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the resulting matrices to DataFrames with appropriate column names</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> vectorizer_tfidf_combined.get_feature_names_out()</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    df_tfidf_train <span class="op">=</span> pd.DataFrame(X_tfidf_train.toarray(), columns<span class="op">=</span>columns)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total sum of TF-IDF values for each n-gram and filter n-grams with total TF-IDF &gt;= 1.0</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    df_total_tfidf <span class="op">=</span> df_tfidf_train.<span class="bu">sum</span>().reset_index()</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    df_total_tfidf.columns <span class="op">=</span> [<span class="st">'ngram'</span>, <span class="st">'total_tfidf'</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ngrams_with_total_tfidf_above_one <span class="op">=</span> df_total_tfidf[df_total_tfidf[<span class="st">'total_tfidf'</span>] <span class="op">&gt;=</span> tfidf_min][<span class="st">'ngram'</span>].tolist()</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a CountVectorizer instance using the filtered n-grams</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    vectorizer_count <span class="op">=</span> CountVectorizer(vocabulary<span class="op">=</span>ngrams_with_total_tfidf_above_one, ngram_range<span class="op">=</span>ngram_range, stop_words<span class="op">=</span><span class="st">'english'</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit and transform the data using the count vectorizer</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    X_count_train <span class="op">=</span> vectorizer_count.fit_transform(df_train[<span class="st">'cleaned_Text'</span>])</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    X_count_test <span class="op">=</span> vectorizer_count.transform(df_test[<span class="st">'cleaned_Text'</span>])</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the resulting matrices to DataFrames with appropriate column names</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    df_count_train <span class="op">=</span> pd.DataFrame(X_count_train.toarray(), columns<span class="op">=</span>vectorizer_count.get_feature_names_out())</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    df_count_test <span class="op">=</span> pd.DataFrame(X_count_test.toarray(), columns<span class="op">=</span>vectorizer_count.get_feature_names_out())</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_count_train, df_count_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 9:</code></pre>
<p>This block of code is applying the get_ngramrange_df function to the Features and NewsHeadlines DataFrames to extract n-gram features and split the data into training and testing sets. Note that the choice of <strong>min_df</strong> and <strong>tfidf_min</strong> is determined by cross validation. See <strong>tfidf.ipynb</strong> for the code.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test <span class="op">=</span> get_ngramrange_df(Features, ngram_range <span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>), min_df<span class="op">=</span><span class="fl">0.06</span>, tfidf_min<span class="op">=</span><span class="fl">0.80</span>, split_ratio<span class="op">=</span><span class="fl">0.625</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>News_train, News_test <span class="op">=</span> get_ngramrange_df(NewsHeadlines, ngram_range <span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), min_df<span class="op">=</span><span class="fl">0.06</span>, tfidf_min<span class="op">=</span><span class="fl">1.00</span>, split_ratio<span class="op">=</span><span class="fl">0.625</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>X_columns <span class="op">=</span> X_train.columns.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 10:</code></pre>
<p>This block of code is dedicated to segregating the n-gram features into separate lists of unigrams and bigrams. This categorization helps in understanding the distribution and contribution of single words (unigrams) versus two-word phrases (bigrams) in the dataset.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize lists for unigrams and bigrams</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>unigrams <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>bigrams <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split X_columns into unigrams and bigrams</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> phrase <span class="kw">in</span> X_columns:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> phrase.split(<span class="st">' '</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        unigrams.append(phrase)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">len</span>(words) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        bigrams.append(phrase)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Unexpected number of words in phrase: </span><span class="sc">{</span>phrase<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 11: **VALIDATING COLLOCATIONS**</code></pre>
<p>This code block is centered around validating the bigrams by ensuring they follow specific part-of-speech patterns. This process is essential for confirming that the bigrams represent meaningful and grammatically valid combinations of words.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validating the collocations</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Justeson and Katz pattern</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_adj_noun_or_noun_noun(ngram):</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> nltk.word_tokenize(ngram)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    pos_tags <span class="op">=</span> [tag <span class="cf">for</span> word, tag <span class="kw">in</span> nltk.pos_tag(words)]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for adjective + noun or noun + noun patterns</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (pos_tags <span class="op">==</span> [<span class="st">'JJ'</span>, <span class="st">'NN'</span>] <span class="kw">or</span> pos_tags <span class="op">==</span> [<span class="st">'NN'</span>, <span class="st">'NN'</span>])</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#verb-Noun and Adverb-Adjective pattern</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_verb_noun_or_adv_adj(bigram):</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> nltk.word_tokenize(bigram)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    pos_tags <span class="op">=</span> [tag <span class="cf">for</span> word, tag <span class="kw">in</span> nltk.pos_tag(words)]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for verb + noun, adverb + adjective, and noun + verb</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pos_tags <span class="kw">in</span> [[<span class="st">'VB'</span>, <span class="st">'NN'</span>], [<span class="st">'VBD'</span>, <span class="st">'NN'</span>], [<span class="st">'VBG'</span>, <span class="st">'NN'</span>], [<span class="st">'VBN'</span>, <span class="st">'NN'</span>], [<span class="st">'VBP'</span>, <span class="st">'NN'</span>], [<span class="st">'VBZ'</span>, <span class="st">'NN'</span>], </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                        [<span class="st">'RB'</span>, <span class="st">'JJ'</span>], [<span class="st">'RBR'</span>, <span class="st">'JJ'</span>], [<span class="st">'RBS'</span>, <span class="st">'JJ'</span>]]</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the function to filter bigrams</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>jk_bigrams <span class="op">=</span> [bigram <span class="cf">for</span> bigram <span class="kw">in</span> bigrams <span class="cf">if</span> is_adj_noun_or_noun_noun(bigram)]</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>vn_bigrams <span class="op">=</span> [bigram <span class="cf">for</span> bigram <span class="kw">in</span> bigrams <span class="cf">if</span> is_verb_noun_or_adv_adj(bigram)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 12:</code></pre>
<p>This code block is responsible for combining the validated bigrams with the unigrams to form two new sets of features for further analysis or modeling.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>X_jk_columns <span class="op">=</span> unigrams <span class="op">+</span> jk_bigrams</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>X_vn_columns <span class="op">=</span> unigrams <span class="op">+</span> vn_bigrams</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 13:</code></pre>
<p>This code block is focused on preparing multiple datasets for model training and testing by subsetting the original datasets based on various feature sets. This step ensures that the models can be trained and tested on different combinations of features (unigrams, jk_bigrams, and vn_bigrams) to evaluate their performance.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>X_unigrams_only_train <span class="op">=</span> X_train[unigrams]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>X_unigrams_only_test <span class="op">=</span> X_test[unigrams]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>X_jk_train <span class="op">=</span> X_train[X_jk_columns]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>X_jk_test <span class="op">=</span> X_test[X_jk_columns]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>X_vn_train <span class="op">=</span> X_train[X_vn_columns]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>X_vn_test <span class="op">=</span> X_test[X_vn_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 14:</code></pre>
<p>This code block is about creating a fixed dictionary of keywords that are known to influence crude oil prices, according to research by Loughran (2019). This dictionary is stored in a list called Fixed_Dictionary. The keywords in the dictionary include terms related to various aspects of oil production and distribution, such as “Attack”, “Outage”, “Production”, “Pumping”, “Refinery”, “Supply”, and many others.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Fixed_Dictionary <span class="op">=</span> [<span class="st">"Attack"</span>, <span class="st">"Outage"</span>, <span class="st">"Discovered"</span>, <span class="st">"Allotment"</span>, <span class="st">"Producing"</span>, <span class="st">"Attacker"</span>, <span class="st">"Outages"</span>, <span class="st">"Discoveries"</span>, <span class="st">"Allotments"</span>, <span class="st">"Production"</span>, <span class="st">"Attackers"</span>, <span class="st">"Problem"</span>, <span class="st">"Discovery"</span>, <span class="st">"Buying"</span>, <span class="st">"Pumping"</span>, <span class="st">"Attacks"</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Problematic"</span>, <span class="st">"Glut"</span>, <span class="st">"Capacities"</span>, <span class="st">"Pumpings"</span>, <span class="st">"Bomb"</span>, <span class="st">"Problematicly"</span>, <span class="st">"Gluts"</span>, <span class="st">"Cargo"</span>, <span class="st">"Quota"</span>, <span class="st">"Bombed"</span>, <span class="st">"Problems"</span>, <span class="st">"Mistrust"</span>, <span class="st">"Cargoe"</span>, <span class="st">"Quotas"</span>, <span class="st">"Refineries"</span>, <span class="st">"Bomber"</span>, <span class="st">"Recoveries"</span>, <span class="st">"Overproducer"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Cargoes"</span>, <span class="st">"Refinery"</span>, <span class="st">"Bombers"</span>, <span class="st">"Recovery"</span>, <span class="st">"Overproducers"</span>, <span class="st">"Constructing"</span>, <span class="st">"Reserves"</span>, <span class="st">"Bombing"</span>, <span class="st">"Sabotage"</span>, <span class="st">"Overproducing"</span>, <span class="st">"Construction"</span>, <span class="st">"Rig"</span>, <span class="st">"Bombings"</span>, <span class="st">"Sabotages"</span>, <span class="st">"Overproduction"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Consumption"</span>, <span class="st">"Rigs"</span>, <span class="st">"Bombs"</span>, <span class="st">"Shortage"</span>, <span class="st">"Oversupplied"</span>, <span class="st">"Demand"</span>, <span class="st">"Stock"</span>, <span class="st">"Closures"</span>, <span class="st">"Shortages"</span>, <span class="st">"Oversupply"</span>, <span class="st">"Demands"</span>, <span class="st">"Stockpile"</span>, <span class="st">"Concerned"</span>, <span class="st">"Storm"</span>, <span class="st">"Oversupplying"</span>, <span class="st">"Difficulties"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Stockpiles"</span>, <span class="st">"Conflict"</span>, <span class="st">"Storms"</span>, <span class="st">"Recession"</span>, <span class="st">"Drilling"</span>, <span class="st">"Stocks"</span>, <span class="st">"Conflicts"</span>, <span class="st">"Strike"</span>, <span class="st">"Recessions"</span>, <span class="st">"Drillings"</span>, <span class="st">"Supplies"</span>, <span class="st">"Cutback"</span>, <span class="st">"Strikers"</span>, <span class="st">"Repaired"</span>, <span class="st">"Economic"</span>, <span class="st">"Supply"</span>, <span class="st">"Cutbacks"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Strikes"</span>, <span class="st">"Repairing"</span>, <span class="st">"Economies"</span>, <span class="st">"Temperature"</span>, <span class="st">"Delay"</span>, <span class="st">"Tension"</span>, <span class="st">"Surplus"</span>, <span class="st">"Economy"</span>, <span class="st">"Temperatures"</span>, <span class="st">"Delayed"</span>, <span class="st">"Tensions"</span>, <span class="st">"Surpluses"</span>, <span class="st">"Embargo"</span>, <span class="st">"Weather"</span>, <span class="st">"Delaying"</span>, <span class="st">"Turmoil"</span>, <span class="st">"Exploration"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Delays"</span>, <span class="st">"Turmoils"</span>, <span class="st">"Export"</span>, <span class="st">"Dispute"</span>, <span class="st">"Unrest"</span>, <span class="st">"Exports"</span>, <span class="st">"Disputed"</span>, <span class="st">"Upheaval"</span>, <span class="st">"Import"</span>, <span class="st">"Disputes"</span>, <span class="st">"Upheavals"</span>, <span class="st">"Imports"</span>, <span class="st">"Disruptions"</span>, <span class="st">"Withdraw"</span>, <span class="st">"Inventories"</span>, <span class="st">"Explosion"</span>, <span class="st">"Withdrawing"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Inventory"</span>, <span class="st">"Explosions"</span>, <span class="st">"Withdrawn"</span>, <span class="st">"Output"</span>, <span class="st">"Fire"</span>, <span class="st">"Outputs"</span>, <span class="st">"Fires"</span>, <span class="st">"Pipeline"</span>, <span class="st">"Hurricane"</span>, <span class="st">"Pipelines"</span>, <span class="st">"Hurricanes"</span>, <span class="st">"Platform"</span>, <span class="st">"Instability"</span>, <span class="st">"Platforms"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 15:</code></pre>
<p>This block of code is dedicated to preprocessing the Fixed_Dictionary to ensure consistency and remove redundancy in the keywords.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the WordNet lemmatizer</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert each word to lowercase and lemmatize it</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>lemmatized_list <span class="op">=</span> [lemmatizer.lemmatize(word.lower()) <span class="cf">for</span> word <span class="kw">in</span> Fixed_Dictionary]</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list to a set and back to a list to remove duplicates</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>final_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(lemmatized_list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[nltk_data] Downloading package wordnet to
[nltk_data]     C:\Users\gabeyie\AppData\Roaming\nltk_data...
[nltk_data]   Package wordnet is already up-to-date!</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 16:</code></pre>
<p>This code block is centered around counting the frequency of each keyword from the final_list (lemmatized and unique keywords from Fixed_Dictionary) in the cleaned_Text column of the Features DataFrame.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store dictionaries</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dict_list <span class="op">=</span> []</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over rows in the original dataframe</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> Features.iterrows():</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the text for the current row</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> row[<span class="st">'cleaned_Text'</span>]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the text into words</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> text.split()</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the frequency of each word</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    word_counts <span class="op">=</span> Counter(words)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize a dictionary to hold the counts for the words in your list</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    count_dict <span class="op">=</span> {}</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each word in your list, get its count and add to the dictionary</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> final_list:</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        count_dict[word] <span class="op">=</span> word_counts.get(word, <span class="dv">0</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the dictionary to the list</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    dict_list.append(count_dict)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list of dictionaries into a dataframe</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>df_counts <span class="op">=</span> pd.DataFrame(dict_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 17:</code></pre>
<p>This block of code is focused on splitting the Fixed and FREDMD dataframes into training and testing sets. This is a standard procedure in machine learning and statistical modeling to evaluate the performance of models on unseen data.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Fixed <span class="op">=</span> df_counts</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>split_ratio <span class="op">=</span> <span class="fl">0.625</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>split_index <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Fixed)<span class="op">*</span>split_ratio)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>Fixed_train <span class="op">=</span> Fixed.iloc[:split_index]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>Fixed_test <span class="op">=</span> Fixed.iloc[split_index:]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>Fredmd_train <span class="op">=</span> FREDMD.iloc[:split_index]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Fredmd_test <span class="op">=</span> FREDMD.iloc[split_index:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 18:</code></pre>
<p>This block of code is involved in further preparing the datasets for model training and testing.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove first row of the training sets. Since we used the monthly log difference of crude oil prices, we loose January 1986. The original data starts from January 1986.</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>X_unigrams_only_train <span class="op">=</span> X_unigrams_only_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>X_jk_train <span class="op">=</span> X_jk_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>X_vn_train <span class="op">=</span> X_vn_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Fixed_train <span class="op">=</span> Fixed_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Fredmd_train <span class="op">=</span> Fredmd_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>News_train <span class="op">=</span> News_train.iloc[<span class="dv">1</span>:, :]</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all sets to arrays</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>X_unigrams_only_train <span class="op">=</span> np.array(X_unigrams_only_train)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>X_unigrams_only_test <span class="op">=</span> np.array(X_unigrams_only_test)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.array(X_train)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> np.array(X_test)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>X_jk_train <span class="op">=</span> np.array(X_jk_train)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>X_jk_test <span class="op">=</span> np.array(X_jk_test)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>X_vn_train <span class="op">=</span> np.array(X_vn_train)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>X_vn_test <span class="op">=</span> np.array(X_vn_test)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>Fixed_train <span class="op">=</span> np.array(Fixed_train)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>Fixed_test <span class="op">=</span> np.array(Fixed_test)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>Fredmd_train <span class="op">=</span> np.array(Fredmd_train)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>Fredmd_test <span class="op">=</span> np.array(Fredmd_test)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>News_train <span class="op">=</span> np.array(News_train)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>News_test <span class="op">=</span> np.array(News_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 19:</code></pre>
<p>In this block of code, two dictionaries, datasets and datasets2, are being created to organize various datasets used in the project into a structured format. This organization makes it easier to iterate over the datasets for further processing, analysis, or modeling.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> {<span class="vs">r'Targeted Features ($D^{*}_{1,t}$)'</span>: (X_train, X_test),</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'N-N/A-N Targeted Features ($D^{*}_{2,t}$)'</span>: (X_jk_train, X_jk_test),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'V-N/Av-A Targeted Features ($D^{*}_{3,t}$)'</span>:(X_vn_train, X_vn_test),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'News Headline Features ($D^{*}_{4,t}$)'</span>: (News_train, News_test)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>datasets2 <span class="op">=</span> {<span class="vs">r'Unigram Features ($D_{5,t}$)'</span>: (X_unigrams_only_train, X_unigrams_only_test),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>             <span class="vs">r'Fixed Dictionary Features ($D_{6,t}$)'</span>: (Fixed_train, Fixed_test),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>             <span class="vs">r'Untargeted FRED-MD Features ($D_{7,t}$)'</span>: (Fredmd_train, Fredmd_test),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>             <span class="vs">r'Untargeted Features ($D_{8,t}$)'</span>: (X_train, X_test)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>            }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 20 and 21: num_factors Function</code></pre>
<p>In this block, the num_factors function is defined to estimate the optimal number of factors to retain from a dataset based on its eigenvalues. The function performs an eigendecomposition and then uses a ratio of consecutive eigenvalues to determine the number of factors.</p>
<p>To determine the number of factors to employ in our principal component analysis (PCA), we adopt a method proposed by Ahn and Horstein (2013) and select upto the second largest (to be conservative) Eigen-value Ratio (ER) or Growth Ratio (GR) for robustness check. We set our <span class="math inline">\(kmax\)</span> to 8. Below are the formulas: <span class="math display">\[
\mathrm{ER}(k) \equiv \frac{\tilde{\mu}_{N T \cdot k}}{\tilde{\mu}_{N T, k+1}}, \quad k=1,2, \ldots, k \max
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\operatorname{GR}(k) &amp; =\frac{\ln [V(k-1) / V(k)]}{\ln [V(k) / V(k+1)]} \\
&amp; =\frac{\ln \left(1+\bar{\mu}_{N T_k}^*\right)}{\ln \left(1+\bar{\mu}_{N T, k+1}\right)}, \quad k=1,2, \ldots, k \max ,
\end{aligned}
\]</span> Where <span class="math inline">\(V(k)=\sum_{l=k+1}^m \tilde{\mu}_{N T, f}\)</span> and <span class="math inline">\(\tilde{\mu}_{N T k}^*=\tilde{\mu}_{N T, k} / V(k)\)</span>.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> num_factors(data, kmax):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    T, N <span class="op">=</span> data.shape</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> <span class="bu">min</span>(kmax, N)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    xx <span class="op">=</span> (data.T <span class="op">@</span> data) <span class="op">/</span> (T<span class="op">*</span>N) <span class="cf">if</span> N <span class="op">&lt;</span> T <span class="cf">else</span> (data <span class="op">@</span> data.T) <span class="op">/</span> (T<span class="op">*</span>N)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    eig_values <span class="op">=</span> np.linalg.eigvals(xx)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="bu">sorted</span>(eig_values, reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    ER <span class="op">=</span> [d[k] <span class="op">/</span> d[k<span class="op">+</span><span class="dv">1</span>] <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    ER <span class="op">=</span> [<span class="dv">0</span> <span class="cf">if</span> np.isnan(e) <span class="kw">or</span> np.isinf(e) <span class="cf">else</span> e <span class="cf">for</span> e <span class="kw">in</span> ER]</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#n_fac = max(ER)</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    n_fac <span class="op">=</span> np.partition(ER, <span class="op">-</span><span class="dv">2</span>)[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    num_factors <span class="op">=</span> ER.index(n_fac) <span class="op">+</span> <span class="dv">1</span> <span class="co"># Remember python indexing starts from 0 so +1</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num_factors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> num_factors_gr(data, kmax):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    T, N <span class="op">=</span> data.shape</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> <span class="bu">min</span>(kmax, N)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    xx <span class="op">=</span> (data.T <span class="op">@</span> data) <span class="op">/</span> (T<span class="op">*</span>N) <span class="cf">if</span> N <span class="op">&lt;</span> T <span class="cf">else</span> (data <span class="op">@</span> data.T) <span class="op">/</span> (T<span class="op">*</span>N)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    eig_values <span class="op">=</span> np.linalg.eigvals(xx)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="bu">sorted</span>(eig_values, reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> [<span class="bu">sum</span>(d[k<span class="op">+</span><span class="dv">1</span>:]) <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K)]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    mu_star <span class="op">=</span> [d[k] <span class="op">/</span> V[k] <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    GR <span class="op">=</span> [np.log(<span class="dv">1</span> <span class="op">+</span> mu_star[k]) <span class="op">/</span> np.log(<span class="dv">1</span> <span class="op">+</span> (d[k<span class="op">+</span><span class="dv">1</span>] <span class="op">/</span> V[k<span class="op">+</span><span class="dv">1</span>])) <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">2</span>)]</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    GR <span class="op">=</span> [<span class="dv">0</span> <span class="cf">if</span> np.isnan(g) <span class="kw">or</span> np.isinf(g) <span class="cf">else</span> g <span class="cf">for</span> g <span class="kw">in</span> GR]</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    n_fac_gr <span class="op">=</span> np.partition(GR, <span class="op">-</span><span class="dv">2</span>)[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    num_factors_gr <span class="op">=</span> GR.index(n_fac_gr) <span class="op">+</span> <span class="dv">1</span> <span class="co"># Remember python indexing starts from 0 so +1</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num_factors_gr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>**ATTENTION MECHANISM MODEL**</code></pre>
<p>Explanation for Code Block 22: Model Training and Prediction with PCA In this block, the code performs a series of operations to train a model and make predictions using PCA for dimensionality reduction. The forecasting is done for multiple horizons.</p>
<ol type="i">
<li><p><strong>Data Preparation</strong>:</p>
<ul>
<li>Extract and standardize the training and testing data up to the forecast origin.</li>
<li>Extract corresponding targets.</li>
</ul></li>
<li><p><strong>Model Training</strong>:</p>
<ul>
<li>If the recession indicator changes, the model is trained on the standardized training data.</li>
<li>If no features are selected, the model is refit with a different <code>l1_ratio</code>.</li>
</ul></li>
<li><p><strong>Feature Selection and PCA</strong>: - If any features are selected by the Elastic Net model, PCA is applied. - The optimal number of PCA components is determined using the <code>num_factors</code> function. - The data is transformed using the best PCA.</p></li>
<li><p><strong>Linear Regression and Significance Testing</strong>:</p>
<ul>
<li>A linear regression model is trained on the PCA-transformed features.</li>
<li>P-values are calculated to find the significant features.</li>
<li>The model is refit using only significant features.</li>
</ul></li>
<li><p><strong>Prediction</strong>:</p>
<ul>
<li>Predictions are made for each time point and stored.</li>
</ul>
<p>Storing Results:</p></li>
</ol>
<p>The predictions and true values for each horizon and model are stored in the respective dictionaries.</p>
<pre><code>Saving Dictionaries:</code></pre>
<p>The dictionaries containing predictions and true values are saved as .pkl files for future use.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize your objects</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>n_splits <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>tscv <span class="op">=</span> TimeSeriesSplit(n_splits<span class="op">=</span>n_splits)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>horizons <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>predictions_dict_pca <span class="op">=</span> {}</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>y_true_dict_pca <span class="op">=</span> {}</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets.items():</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    predictions_dict_pca[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    y_true_dict_pca[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the model outside the loop</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> ElasticNetCV(l1_ratio<span class="op">=</span>[<span class="fl">.1</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">.9</span>, <span class="fl">.95</span>, <span class="fl">.99</span>, <span class="dv">1</span>], cv<span class="op">=</span>tscv, max_iter<span class="op">=</span><span class="dv">10000</span>, tol<span class="op">=</span><span class="fl">0.0001</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define a variable to keep track of the last observed value of the recession indicator</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    last_indicator <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        y_true_per_pca_horizon <span class="op">=</span> []</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        y_pred_per_pca_horizon <span class="op">=</span> []</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get train and test data up to the forecast origin</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>            train_temp <span class="op">=</span> data[:i]</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>            test_temp <span class="op">=</span> data[i:i<span class="op">+</span>h]</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Standardize the data</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>            scaler.fit(train_temp)</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>            train_temp_standardized <span class="op">=</span> scaler.transform(train_temp)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>            test_temp_standardized <span class="op">=</span> scaler.transform(test_temp)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if we should update the model (i.e., if there is a change in the recession_indicator)</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>            current_indicator <span class="op">=</span> update[<span class="st">'indicator'</span>][i]</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> current_indicator <span class="op">!=</span> last_indicator:</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Update the last observed value of the recession indicator</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>                last_indicator <span class="op">=</span> current_indicator</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Train the model</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>                model.fit(train_temp_standardized, np.ravel(y_train_temp))</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no features were selected, refit the model with a different l1_ratio</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>                refit_attempts <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="bu">len</span>(np.nonzero(model.coef_)[<span class="dv">0</span>]) <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">and</span> refit_attempts <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>                    model.set_params(l1_ratio <span class="op">=</span> <span class="fl">0.05</span>)  <span class="co"># Choose a suitable l1_ratio</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>                    model.fit(train_temp_standardized, np.ravel(y_train_temp))</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>                    refit_attempts <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If still no features were selected after 2 attempts, print a warning</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(np.nonzero(model.coef_)[<span class="dv">0</span>]) <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'Warning: Model failed to select more than one feature after </span><span class="sc">{</span>refit_attempts<span class="sc">}</span><span class="ss"> attempts.'</span>)</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If any features were selected, apply PCA</span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> model.coef_.<span class="bu">any</span>():</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Get indices of non-zero coefficients</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>                selected_features <span class="op">=</span> np.nonzero(model.coef_)[<span class="dv">0</span>]</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Select the features that were not discarded by the ElasticNet</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>                selected_train_temp <span class="op">=</span> train_temp[:, selected_features]</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>                selected_test_temp <span class="op">=</span> test_temp[:, selected_features]</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Initialize and fit a new scaler on the selected features</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>                scaler_pca <span class="op">=</span> StandardScaler()</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>                scaler_pca.fit(selected_train_temp)</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Standardize selected features</span></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>                selected_train_temp_standardized <span class="op">=</span> scaler_pca.transform(selected_train_temp)</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>                selected_test_temp_standardized <span class="op">=</span> scaler_pca.transform(selected_test_temp)</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Define PCA</span></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>                n_components <span class="op">=</span> num_factors(selected_train_temp_standardized, kmax<span class="op">=</span><span class="dv">8</span>)  <span class="co"># Choose a suitable value for kmax</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>                pca <span class="op">=</span> PCA(n_components<span class="op">=</span> n_components)</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>                best_pca <span class="op">=</span> pca.fit(selected_train_temp_standardized)</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Transform data using the best PCA</span></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>                selected_train_temp_pca <span class="op">=</span> best_pca.transform(selected_train_temp_standardized)</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>                selected_test_temp_pca <span class="op">=</span> best_pca.transform(selected_test_temp_standardized)</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Train a linear regression model and compute p-values</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>                lr <span class="op">=</span> LinearRegression()</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Calculate p-values</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>                mod <span class="op">=</span> sm.OLS(np.ravel(y_train_temp), sm.add_constant(selected_train_temp_pca))</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>                fii <span class="op">=</span> mod.fit()</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>                p_values <span class="op">=</span> fii.summary2().tables[<span class="dv">1</span>][<span class="st">'P&gt;|t|'</span>]</span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the significant features</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>                significant_features <span class="op">=</span> p_values[p_values <span class="op">&lt;</span> <span class="fl">0.05</span>].index  <span class="co"># Find features with p-value &lt; 0.05</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Ignore the constant term</span></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a>                significant_features <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> significant_features <span class="cf">if</span> i <span class="op">!=</span> <span class="st">'const'</span>]</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create a mapping from column names to indices</span></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>                column_to_index <span class="op">=</span> {col: idx<span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> idx, col <span class="kw">in</span> <span class="bu">enumerate</span>(fii.summary2().tables[<span class="dv">1</span>].index)}  <span class="co"># idx-1 corrects for the added constant</span></span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Convert column names to indices</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>                significant_indices <span class="op">=</span> [column_to_index[col] <span class="cf">for</span> col <span class="kw">in</span> significant_features <span class="cf">if</span> column_to_index[col] <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>]  <span class="co"># We make sure not to include the constant</span></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If there are significant features, retrain the model on these</span></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> significant_indices:</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>                    selected_train_temp_pca <span class="op">=</span> selected_train_temp_pca[:, significant_indices]</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>                    selected_test_temp_pca <span class="op">=</span> selected_test_temp_pca[:, significant_indices]</span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"No features with p-value &lt; 0.05 was found. Retaining all PCA-transformed features."</span>)</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Fit the model on the selected (or all) PCA-transformed features</span></span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>                lr.fit(selected_train_temp_pca, np.ravel(y_train_temp))</span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Make a prediction and add it to the predictions list</span></span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>                y_pred_pca_temp <span class="op">=</span> lr.predict(selected_test_temp_pca)</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>                y_pred_per_pca_horizon.append(y_pred_pca_temp[h<span class="op">-</span><span class="dv">1</span>]) <span class="co"># Remember python indexing starts from 0</span></span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add true values to a list</span></span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>                y_true_per_pca_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>]) <span class="co"># Remember python indexing starts from 0</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a>        predictions_dict_pca[model_name][h] <span class="op">=</span> y_pred_per_pca_horizon</span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a>        y_true_dict_pca[model_name][h] <span class="op">=</span> y_true_per_pca_horizon</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_dict_pca.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_dict_pca, f)</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_true_dict_pca.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_true_dict_pca, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Explanation for Code Block 23: Verifying Number of Predictions</code></pre>
<p>This block is used to ensure that the number of predictions generated by the model for each forecasting horizon is as expected. Verifying the number of predictions is crucial for ensuring the model’s reliability and for diagnosing any issues in the forecasting process.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over models</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca.keys():</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> predictions_dict_pca[model_name].keys():</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the length of the list of predictions for this model and horizon</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        num_predictions <span class="op">=</span> <span class="bu">len</span>(predictions_dict_pca[model_name][h])</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print the number of predictions</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_predictions<span class="sc">}</span><span class="ss"> predictions'</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print a blank line for readability</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 144 predictions
Horizon 3: 142 predictions
Horizon 6: 139 predictions
Horizon 9: 136 predictions

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 144 predictions
Horizon 3: 142 predictions
Horizon 6: 139 predictions
Horizon 9: 136 predictions

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 144 predictions
Horizon 3: 142 predictions
Horizon 6: 139 predictions
Horizon 9: 136 predictions

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: 144 predictions
Horizon 3: 142 predictions
Horizon 6: 139 predictions
Horizon 9: 136 predictions
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over models</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> y_true_dict_pca.keys():</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> y_true_dict_pca[model_name].keys():</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the length of the list of oss obs for this model and horizon</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        num_oos <span class="op">=</span> <span class="bu">len</span>(y_true_dict_pca[model_name][h])</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print the number of obs</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_oos<span class="sc">}</span><span class="ss"> Out-of-sample Observations'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print a blank line for readability</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 144 Out-of-sample Observations
Horizon 3: 142 Out-of-sample Observations
Horizon 6: 139 Out-of-sample Observations
Horizon 9: 136 Out-of-sample Observations

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 144 Out-of-sample Observations
Horizon 3: 142 Out-of-sample Observations
Horizon 6: 139 Out-of-sample Observations
Horizon 9: 136 Out-of-sample Observations

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 144 Out-of-sample Observations
Horizon 3: 142 Out-of-sample Observations
Horizon 6: 139 Out-of-sample Observations
Horizon 9: 136 Out-of-sample Observations

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: 144 Out-of-sample Observations
Horizon 3: 142 Out-of-sample Observations
Horizon 6: 139 Out-of-sample Observations
Horizon 9: 136 Out-of-sample Observations
</code></pre>
</div>
</div>
<pre><code>HISTORICAL AVERAGE BENCHMARK MODEL
Explanation for Code Block 24: Computing Historical Average Predictions</code></pre>
<p>This block is dedicated to calculating the predictions for each model and each forecast horizon based on the historical average. This is a simple baseline forecasting method where the future values are predicted based on the average of past observed values.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>predictions_historical_avg_dict <span class="op">=</span> {}</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>y_true_historical_avg_dict <span class="op">=</span> {}</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets.items():</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    predictions_historical_avg_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    y_true_historical_avg_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        y_true_historical_per_horizon <span class="op">=</span> []</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        y_pred_historical_per_horizon <span class="op">=</span> []</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute historical average</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>            historical_avg <span class="op">=</span> np.mean(y_train_temp)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use historical average as prediction</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>            y_pred_temp <span class="op">=</span> np.full(h, historical_avg)</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append prediction and true value to lists</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>            y_pred_historical_per_horizon.append(y_pred_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>            y_true_historical_per_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store predictions and true values for this horizon</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>        predictions_historical_avg_dict[model_name][h] <span class="op">=</span> y_pred_historical_per_horizon</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        y_true_historical_avg_dict[model_name][h] <span class="op">=</span> y_true_historical_per_horizon </span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_historical_avg_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_historical_avg_dict, f)</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_true_historical_avg_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_true_historical_avg_dict, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>AUTOREGRESSIVE BENCHMARK MODEL
Explanation for Code Block 25: Computing Autoregressive (AR) Predictions</code></pre>
<p>This block calculates the AR model predictions for each model and forecast horizon. An AR model is a representation of a type of random process; as such, it is used to describe certain time-dependent processes in nature, economics, etc.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>predictions_ar_dict <span class="op">=</span> {}</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>y_true_ar_dict <span class="op">=</span> {}</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets.items():</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    predictions_ar_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    y_true_ar_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        y_true_per_ar_horizon <span class="op">=</span> []</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>        y_pred_per_ar_horizon <span class="op">=</span> []</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine the order of the AR model using AIC</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>            AIC <span class="op">=</span> []</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>):  <span class="co"># for simplicity, consider orders up to 10</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>                model_temp <span class="op">=</span> AutoReg(y_train_temp, lags<span class="op">=</span>p, old_names<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>                result_temp <span class="op">=</span> model_temp.fit()</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>                AIC.append(result_temp.aic)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>            optimal_p <span class="op">=</span> np.argmin(AIC) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fit the AR model of order optimal_p</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>            model_ar <span class="op">=</span> AutoReg(y_train_temp, lags<span class="op">=</span>optimal_p, old_names<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>            result_ar <span class="op">=</span> model_ar.fit()</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make a prediction and add it to the predictions list</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>            y_pred_temp <span class="op">=</span> result_ar.predict(start<span class="op">=</span><span class="bu">len</span>(y_train_temp), end<span class="op">=</span><span class="bu">len</span>(y_train_temp)<span class="op">+</span>h<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>            y_pred_per_ar_horizon.append(y_pred_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append true value to list</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>            y_true_per_ar_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store predictions and true values for this horizon</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        predictions_ar_dict[model_name][h] <span class="op">=</span> y_pred_per_ar_horizon</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>        y_true_ar_dict[model_name][h] <span class="op">=</span> y_true_per_ar_horizon </span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_ar_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_ar_dict, f)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_true_ar_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_true_ar_dict, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>RELATIVE ROOT MEAN SQUARE ERROR WITH HISTORICAL AVERAGE BENCHMARK MODEL - MODEL EVALUATION
Explanation for Code Block 25: Computing RMSFE and RRMSFE</code></pre>
<p>This block calculates the RMSFE and RRMSFE for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by a historical average (HA) model.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing RMSFE for each horizon and each model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>rmsfe_dict <span class="op">=</span> {}</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>rrmsfe_dict <span class="op">=</span> {}</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    rmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    rrmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_dict_pca[model_name][h])</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (Historical Average model)</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_dict[model_name][h])</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSFE for this model and benchmark model</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>        msfe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>        msfe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>        rmsfe_model <span class="op">=</span> sqrt(msfe_model)</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RRMSFE for this model</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>        rrmsfe_model <span class="op">=</span> sqrt(msfe_model <span class="op">/</span> msfe_benchmark)</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store MSFE and RRMSFE for this horizon</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>        rmsfe_dict[model_name][h] <span class="op">=</span> rmsfe_model</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>        rrmsfe_dict[model_name][h] <span class="op">=</span> rrmsfe_model</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Relative Root Mean Squared Forecast Errors (RRMSFE) against HA:"</span>)</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, rrmsfe_values <span class="kw">in</span> rrmsfe_dict.items():</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, rrmsfe <span class="kw">in</span> rrmsfe_values.items():</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rrmsfe<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Relative Root Mean Squared Forecast Errors (RRMSFE) against HA:

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 0.884
Horizon 3: 0.816
Horizon 6: 0.824
Horizon 9: 0.800

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 0.870
Horizon 3: 0.848
Horizon 6: 0.864
Horizon 9: 0.817

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 0.802
Horizon 3: 0.819
Horizon 6: 0.806
Horizon 9: 0.795

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: 0.986
Horizon 3: 0.970
Horizon 6: 0.973
Horizon 9: 0.940</code></pre>
</div>
</div>
<pre><code>RELATIVE ROOT MEAN SQUARE ERROR WITH AUTOREGRESSIVE BENCHMARK MODEL- MODEL EVALUATION
Explanation for Code Block 25: Computing RMSFE and RRMSFE</code></pre>
<p>This block calculates the RMSFE and RRMSFE for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by Autoregressive (AR(p)) model.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing RMSFE for each horizon and each model</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>rmsfe_dict <span class="op">=</span> {}</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>rrmsfe_dict <span class="op">=</span> {}</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    rmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    rrmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_dict[model_name][h])</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_dict[model_name][h])</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSFE for this model and benchmark model</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        msfe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>        msfe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        rmsfe_model <span class="op">=</span> sqrt(msfe_model)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RRMSFE for this model</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>        rrmsfe_model <span class="op">=</span> sqrt(msfe_model <span class="op">/</span> msfe_benchmark)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store MSFE and RRMSFE for this horizon</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>        rmsfe_dict[model_name][h] <span class="op">=</span> rmsfe_model</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>        rrmsfe_dict[model_name][h] <span class="op">=</span> rrmsfe_model</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Relative Root Mean Squared Forecast Errors (RRMSFE) against AR(p):"</span>)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, rrmsfe_values <span class="kw">in</span> rrmsfe_dict.items():</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, rrmsfe <span class="kw">in</span> rrmsfe_values.items():</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rrmsfe<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Relative Root Mean Squared Forecast Errors (RRMSFE) against AR(p):

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 0.924
Horizon 3: 0.812
Horizon 6: 0.827
Horizon 9: 0.800

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 0.910
Horizon 3: 0.843
Horizon 6: 0.868
Horizon 9: 0.816

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 0.839
Horizon 3: 0.815
Horizon 6: 0.809
Horizon 9: 0.795

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: 1.031
Horizon 3: 0.965
Horizon 6: 0.977
Horizon 9: 0.940</code></pre>
</div>
</div>
<pre><code>OUT OF SAMPLE R-SQUARED WITH HISTORICAL AVERAGE BENCHMARK MODEL-MODEL EVALUATION
Explanation for Code Block 26: Computing Out-Of-Sample R-squared </code></pre>
<p>This block calculates the out-of-sample R-squared for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by a historical average (HA) model.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing o-o-s R-squared for each horizon and each model</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>r2_oos_dict <span class="op">=</span> {}</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca.keys():</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    r2_oos_dict[model_name] <span class="op">=</span> {}</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_dict[model_name][h])</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (Historical Average model)</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_dict[model_name][h])</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSPE for the model and benchmark</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        mspe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        mspe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate R^2_oos</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        r2_oos <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (mspe_model <span class="op">/</span> mspe_benchmark))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>        r2_oos_dict[model_name][h] <span class="op">=</span> r2_oos</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Out-of-sample R-squared (OOS-Rsq) against HA:"</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, oos_values <span class="kw">in</span> r2_oos_dict.items():</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, oos <span class="kw">in</span> oos_values.items():</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>oos<span class="sc">:.2f}</span><span class="ss">"</span>)  <span class="co"># .2f is for displaying only up to 2 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Out-of-sample R-squared (OOS-Rsq) against HA:

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 21.87
Horizon 3: 33.42
Horizon 6: 32.14
Horizon 9: 35.93

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 24.32
Horizon 3: 28.16
Horizon 6: 25.28
Horizon 9: 33.31

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 35.65
Horizon 3: 32.98
Horizon 6: 35.10
Horizon 9: 36.83

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: 2.86
Horizon 3: 5.93
Horizon 6: 5.26
Horizon 9: 11.67</code></pre>
</div>
</div>
<pre><code>OUT OF SAMPLE R-SQUARED WITH AutoRegressive BENCHMARK MODEL-MODEL EVALUATION
Explanation for Code Block 27: Computing Out-Of-Sample R-squared </code></pre>
<p>This block calculates the out-of-sample R-squared for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by an autoregressive (AR) model.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing o-o-s R-squared for each horizon and each model</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>r2_oos_dict <span class="op">=</span> {}</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca.keys():</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    r2_oos_dict[model_name] <span class="op">=</span> {}</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_dict[model_name][h])</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_dict[model_name][h])</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSPE for the model and benchmark</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        mspe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        mspe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate R^2_oos</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>        r2_oos <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (mspe_model <span class="op">/</span> mspe_benchmark))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>        r2_oos_dict[model_name][h] <span class="op">=</span> r2_oos</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Out-of-sample R-squared (OOS-Rsq) against AR(p):"</span>)</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, oos_values <span class="kw">in</span> r2_oos_dict.items():</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, oos <span class="kw">in</span> oos_values.items():</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>oos<span class="sc">:.2f}</span><span class="ss">"</span>)  <span class="co"># .2f is for displaying only up to 2 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Out-of-sample R-squared (OOS-Rsq) against AR(p):

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: 14.57
Horizon 3: 34.09
Horizon 6: 31.65
Horizon 9: 35.98

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: 17.26
Horizon 3: 28.88
Horizon 6: 24.73
Horizon 9: 33.35

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: 29.64
Horizon 3: 33.65
Horizon 6: 34.62
Horizon 9: 36.88

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: -6.21
Horizon 3: 6.86
Horizon 6: 4.56
Horizon 9: 11.73</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 28: Diebold-Mariano Test</code></pre>
<p>This block performs the Diebold-Mariano (DM) test for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by an AutoRegressive (AR) model.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing DM test results for each horizon and each model</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>dm_test_results_dict <span class="op">=</span> {}</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    dm_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_dict[model_name][h])</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_dict[model_name][h])</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Diebold-Mariano test</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        dm_stat, p_value <span class="op">=</span> dm_test(y_true, y_pred, y_benchmark, one_sided <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the DM test results</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        dm_test_results_dict[model_name][h] <span class="op">=</span> (dm_stat, p_value) <span class="co"># Negative for greater than one-sided</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Diebold-Mariano test results aginst AR(p):"</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, dm_results <span class="kw">in</span> dm_test_results_dict.items():</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (dm_stat, p_value) <span class="kw">in</span> dm_results.items():</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: DM Statistic: </span><span class="sc">{</span>dm_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Diebold-Mariano test results aginst AR(p):

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: DM Statistic: -1.350, p-value: 0.090
Horizon 3: DM Statistic: -2.404, p-value: 0.009
Horizon 6: DM Statistic: -2.193, p-value: 0.015
Horizon 9: DM Statistic: -2.418, p-value: 0.008

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: DM Statistic: -1.743, p-value: 0.042
Horizon 3: DM Statistic: -2.156, p-value: 0.016
Horizon 6: DM Statistic: -1.957, p-value: 0.026
Horizon 9: DM Statistic: -2.303, p-value: 0.011

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: DM Statistic: -2.612, p-value: 0.005
Horizon 3: DM Statistic: -2.311, p-value: 0.011
Horizon 6: DM Statistic: -2.400, p-value: 0.009
Horizon 9: DM Statistic: -2.335, p-value: 0.011

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: DM Statistic: 0.853, p-value: 0.802
Horizon 3: DM Statistic: -1.351, p-value: 0.089
Horizon 6: DM Statistic: -1.120, p-value: 0.132
Horizon 9: DM Statistic: -1.953, p-value: 0.026</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 29: clark-Werst Test</code></pre>
<p>This block performs the Clark-West (CW) test for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by an AutoRegressive (AR) model.</p>
<p><strong>NOTE</strong> : The CW test statistics was not presented in the manuscript but available</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing Clark-West test results for each horizon and each model</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>cw_test_results_dict <span class="op">=</span> {}</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    cw_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_dict[model_name][h])</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_dict[model_name][h])</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss difference</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> (benchmark_errors <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> (model_errors <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the extra term for Clark-West test</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>        cw_extra_term <span class="op">=</span> (benchmark_errors <span class="op">-</span> model_errors) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Clark-West test</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>        cw_stat <span class="op">=</span> d.mean() <span class="op">/</span> (np.sqrt((d <span class="op">-</span> cw_extra_term).var() <span class="op">/</span> <span class="bu">len</span>(d)))</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since the Clark-West test is one-sided, we take the complement of the cumulative distribution function</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.norm.cdf(cw_stat)</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the Clark-West test results</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>        cw_test_results_dict[model_name][h] <span class="op">=</span> (cw_stat, p_value)</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Clark-West test results against AR(p):"</span>)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, cw_results <span class="kw">in</span> cw_test_results_dict.items():</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (cw_stat, p_value) <span class="kw">in</span> cw_results.items():</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: CW Statistic: </span><span class="sc">{</span>cw_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Clark-West test results against AR(p):

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: CW Statistic: 1.503, p-value: 0.066
Horizon 3: CW Statistic: 3.434, p-value: 0.000
Horizon 6: CW Statistic: 3.211, p-value: 0.001
Horizon 9: CW Statistic: 3.915, p-value: 0.000

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: CW Statistic: 2.249, p-value: 0.012
Horizon 3: CW Statistic: 2.867, p-value: 0.002
Horizon 6: CW Statistic: 2.437, p-value: 0.007
Horizon 9: CW Statistic: 3.829, p-value: 0.000

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: CW Statistic: 3.168, p-value: 0.001
Horizon 3: CW Statistic: 2.942, p-value: 0.002
Horizon 6: CW Statistic: 3.463, p-value: 0.000
Horizon 9: CW Statistic: 3.992, p-value: 0.000

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: CW Statistic: -0.788, p-value: 0.785
Horizon 3: CW Statistic: 1.362, p-value: 0.087
Horizon 6: CW Statistic: 1.125, p-value: 0.130
Horizon 9: CW Statistic: 2.138, p-value: 0.016</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 30: clark-Werst Test</code></pre>
<p>This block performs the Clark-West (CW) test for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by a Historical Average (HA) model.</p>
<p><strong>NOTE</strong> : The CW test statistics was not presented in the manuscript but available</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing Clark-West test results for each horizon and each model</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>cw_test_results_dict <span class="op">=</span> {}</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    cw_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_dict[model_name][h])</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (Historical Average model)</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_dict[model_name][h])</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss difference</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> (benchmark_errors <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> (model_errors <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the extra term for Clark-West test</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>        cw_extra_term <span class="op">=</span> (benchmark_errors <span class="op">-</span> model_errors) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Clark-West test</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>        cw_stat <span class="op">=</span> d.mean() <span class="op">/</span> (np.sqrt((d <span class="op">-</span> cw_extra_term).var() <span class="op">/</span> <span class="bu">len</span>(d)))</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since the Clark-West test is one-sided, we take the complement of the cumulative distribution function</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.norm.cdf(cw_stat)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the Clark-West test results</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>        cw_test_results_dict[model_name][h] <span class="op">=</span> (cw_stat, p_value)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Clark-West test results against HA:"</span>)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, cw_results <span class="kw">in</span> cw_test_results_dict.items():</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (cw_stat, p_value) <span class="kw">in</span> cw_results.items():</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: CW Statistic: </span><span class="sc">{</span>cw_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Clark-West test results against HA:

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: CW Statistic: 3.064, p-value: 0.001
Horizon 3: CW Statistic: 3.701, p-value: 0.000
Horizon 6: CW Statistic: 3.487, p-value: 0.000
Horizon 9: CW Statistic: 3.986, p-value: 0.000

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: CW Statistic: 3.615, p-value: 0.000
Horizon 3: CW Statistic: 3.197, p-value: 0.001
Horizon 6: CW Statistic: 2.657, p-value: 0.004
Horizon 9: CW Statistic: 3.902, p-value: 0.000

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: CW Statistic: 3.749, p-value: 0.000
Horizon 3: CW Statistic: 3.264, p-value: 0.001
Horizon 6: CW Statistic: 3.658, p-value: 0.000
Horizon 9: CW Statistic: 4.083, p-value: 0.000

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: CW Statistic: 0.765, p-value: 0.222
Horizon 3: CW Statistic: 1.910, p-value: 0.028
Horizon 6: CW Statistic: 1.619, p-value: 0.053
Horizon 9: CW Statistic: 2.160, p-value: 0.015</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 31: Diebold-Mariano Test</code></pre>
<p>This block performs the Diebold-Mariano (DM) test for each model and each forecast horizon by comparing the predictions made by each model with the actual values and the predictions made by an Historical Average (HA) model.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing DM test results for each horizon and each model</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>dm_test_results_dict <span class="op">=</span> {}</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets.items():</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    dm_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_dict[model_name][h])</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (Historical Average model)</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_dict[model_name][h])</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Diebold-Mariano test</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>        dm_stat, p_value <span class="op">=</span> dm_test(y_true, y_pred, y_benchmark, one_sided <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the DM test results</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>        dm_test_results_dict[model_name][h] <span class="op">=</span> (dm_stat, p_value)</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Diebold-Mariano test results against HA:"</span>)</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, dm_results <span class="kw">in</span> dm_test_results_dict.items():</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (dm_stat, p_value) <span class="kw">in</span> dm_results.items():</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: DM Statistic: </span><span class="sc">{</span>dm_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Diebold-Mariano test results against HA:

Model: Targeted Features ($D^{*}_{1,t}$)
Horizon 1: DM Statistic: -2.252, p-value: 0.013
Horizon 3: DM Statistic: -2.509, p-value: 0.007
Horizon 6: DM Statistic: -2.315, p-value: 0.011
Horizon 9: DM Statistic: -2.454, p-value: 0.008

Model: N-N/A-N Targeted Features ($D^{*}_{2,t}$)
Horizon 1: DM Statistic: -2.203, p-value: 0.015
Horizon 3: DM Statistic: -2.263, p-value: 0.013
Horizon 6: DM Statistic: -2.088, p-value: 0.019
Horizon 9: DM Statistic: -2.340, p-value: 0.010

Model: V-N/Av-A Targeted Features ($D^{*}_{3,t}$)
Horizon 1: DM Statistic: -2.619, p-value: 0.005
Horizon 3: DM Statistic: -2.421, p-value: 0.008
Horizon 6: DM Statistic: -2.489, p-value: 0.007
Horizon 9: DM Statistic: -2.374, p-value: 0.009

Model: News Headline Features ($D^{*}_{4,t}$)
Horizon 1: DM Statistic: -0.787, p-value: 0.216
Horizon 3: DM Statistic: -1.811, p-value: 0.036
Horizon 6: DM Statistic: -1.570, p-value: 0.059
Horizon 9: DM Statistic: -1.981, p-value: 0.025</code></pre>
</div>
</div>
<pre><code>Explanation for Code Block 32: Plotting CSPE Difference between Models and AR Model</code></pre>
<p>This block of code visualizes the cumulative squared prediction errors (CSPE) of the models <span class="math inline">\(D_{1,t}\)</span>, <span class="math inline">\(D_{2,t}\)</span>, <span class="math inline">\(D_{3,t}\)</span>, <span class="math inline">\(D_{4,t}\)</span>, and compares them with an AR model across different forecasting horizons.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of models</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> <span class="bu">list</span>(predictions_dict_pca.keys())</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates of the Great Recession (according to NBER)</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>recession_start <span class="op">=</span> pd.to_datetime(<span class="st">'2007-12-01'</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>recession_end <span class="op">=</span> pd.to_datetime(<span class="st">'2009-06-30'</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique horizons</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>n_horizons <span class="op">=</span> <span class="bu">len</span>(horizons)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique models</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid of subplots: n_horizons rows and n_models columns</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(n_horizons, n_models, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span> <span class="op">*</span> n_horizons))</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten array to easily iterate over it in a single loop</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each horizon</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> h_idx, h <span class="kw">in</span> <span class="bu">enumerate</span>(horizons):</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each model</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m_idx, model_name <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axs[n_models <span class="op">*</span> h_idx <span class="op">+</span> m_idx]  <span class="co"># Assign subplot position</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get AutoRegressive predictions for this model</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_dict[model_name][h])</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_dict[model_name][h])</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>        e1 <span class="op">=</span> (y_true <span class="op">-</span> y_pred) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from your model</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>        e2 <span class="op">=</span> (y_true <span class="op">-</span> y_benchmark) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from the benchmark model</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate CSPE for the model and benchmark</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>        cspe_model <span class="op">=</span> np.cumsum(e1)</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>        cspe_benchmark <span class="op">=</span> np.cumsum(e2)</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust dates based on the horizon</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> oos_base_dates[h<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot CSPE</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>        y_values <span class="op">=</span> cspe_benchmark <span class="op">-</span> cspe_model</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>        ax.plot(dates, y_values, label<span class="op">=</span><span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a shaded region for the recession</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>        ax.axvspan(recession_start, recession_end, color<span class="op">=</span><span class="st">'silver'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set y-limit such that 0 is in the middle</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>        y_abs_max <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(y_values.<span class="bu">min</span>()), <span class="bu">abs</span>(y_values.<span class="bu">max</span>()))</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span>y_abs_max<span class="op">-</span><span class="fl">0.1</span>, y_abs_max<span class="op">+</span><span class="fl">0.1</span>)</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>        ax.set_title(model_name)</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'elpca_ar_cspe.eps'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="main_script_PVAM_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<pre><code>Explanation for Code Block 33: Plotting CSPE Difference between Models and HA Model</code></pre>
<p>This block of code visualizes the cumulative squared prediction errors (CSPE) of the models <span class="math inline">\(D_{1,t}\)</span>, <span class="math inline">\(D_{2,t}\)</span>, <span class="math inline">\(D_{3,t}\)</span>, <span class="math inline">\(D_{4,t}\)</span>, and compares them with an HA model across different forecasting horizons.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of models</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> <span class="bu">list</span>(predictions_dict_pca.keys())</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates of the Great Recession (according to NBER)</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>recession_start <span class="op">=</span> pd.to_datetime(<span class="st">'2007-12-01'</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>recession_end <span class="op">=</span> pd.to_datetime(<span class="st">'2009-06-30'</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique horizons</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>n_horizons <span class="op">=</span> <span class="bu">len</span>(horizons)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique models</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid of subplots: n_horizons rows and n_models columns</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(n_horizons, n_models, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span> <span class="op">*</span> n_horizons))</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten array to easily iterate over it in a single loop</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each horizon</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> h_idx, h <span class="kw">in</span> <span class="bu">enumerate</span>(horizons):</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each model</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m_idx, model_name <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axs[n_models <span class="op">*</span> h_idx <span class="op">+</span> m_idx]  <span class="co"># Assign subplot position</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get hISTORICAL AVERAGE predictions for this model</span></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_dict[model_name][h])</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_dict[model_name][h])</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca[model_name][h])</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>        e1 <span class="op">=</span> (y_true <span class="op">-</span> y_pred) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from your model</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>        e2 <span class="op">=</span> (y_true <span class="op">-</span> y_benchmark) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from the benchmark model</span></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate CSPE for the model and benchmark</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>        cspe_model <span class="op">=</span> np.cumsum(e1)</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>        cspe_benchmark <span class="op">=</span> np.cumsum(e2)</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust dates based on the horizon</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> oos_base_dates[h<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot CSPE</span></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>        y_values <span class="op">=</span> cspe_benchmark <span class="op">-</span> cspe_model</span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>        ax.plot(dates, y_values, label<span class="op">=</span><span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a shaded region for the recession</span></span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>        ax.axvspan(recession_start, recession_end, color<span class="op">=</span><span class="st">'silver'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set y-limit such that 0 is in the middle</span></span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>        y_abs_max <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(y_values.<span class="bu">min</span>()), <span class="bu">abs</span>(y_values.<span class="bu">max</span>()))</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span>y_abs_max<span class="op">-</span><span class="fl">0.1</span>, y_abs_max<span class="op">+</span><span class="fl">0.1</span>)</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>        ax.set_title(model_name)</span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'elpca_ha_cspe.eps'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="main_script_PVAM_files/figure-html/cell-37-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The block of codes below are for models <span class="math inline">\(D_{5,t}\)</span>, <span class="math inline">\(D_{6,t}\)</span>, <span class="math inline">\(D_{7,t}\)</span>, <span class="math inline">\(D_{8,t}\)</span>. These are model that did not go through any pattern validation or attention mechanism. The codes are similar to those explain above. Refer accordingly.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize your objects</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>n_splits <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>tscv <span class="op">=</span> TimeSeriesSplit(n_splits<span class="op">=</span>n_splits)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>predictions_dict_pca_only <span class="op">=</span> {}</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>y_true_dict_pca_only <span class="op">=</span> {}</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets2.items():</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    predictions_dict_pca_only[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    y_true_dict_pca_only[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>        y_true_per_pca_only_horizon <span class="op">=</span> []</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>        y_pred_per_pca_only_horizon <span class="op">=</span> []</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get train and test data up to the forecast origin</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>            train_temp <span class="op">=</span> data[:i]</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>            test_temp <span class="op">=</span> data[i:i<span class="op">+</span>h]</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Standardize the data</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>            scaler.fit(train_temp)</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>            train_temp_standardized <span class="op">=</span> scaler.transform(train_temp)</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>            test_temp_standardized <span class="op">=</span> scaler.transform(test_temp)</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Now perform PCA with the chosen number of components</span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>            n_components <span class="op">=</span> num_factors(train_temp_standardized, kmax<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>            pca <span class="op">=</span> PCA(n_components<span class="op">=</span> n_components)</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>            best_pca <span class="op">=</span> pca.fit(train_temp_standardized)</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Transform data using the best PCA</span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>            train_temp_pca <span class="op">=</span> best_pca.transform(train_temp_standardized)</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>            test_temp_pca <span class="op">=</span> best_pca.transform(test_temp_standardized)</span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Train a linear regression model on the PCA-transformed data</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>            lr <span class="op">=</span> LinearRegression()</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>            lr.fit(train_temp_pca, np.ravel(y_train_temp))</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make a prediction and add it to the predictions list</span></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a>            y_pred_pca_temp <span class="op">=</span> lr.predict(test_temp_pca)</span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>            y_pred_per_pca_only_horizon.append(y_pred_pca_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert true values to a list</span></span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a>            y_true_per_pca_only_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store predictions and true values for this horizon</span></span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a>        predictions_dict_pca_only[model_name][h] <span class="op">=</span> y_pred_per_pca_only_horizon</span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a>        y_true_dict_pca_only[model_name][h] <span class="op">=</span> y_true_per_pca_only_horizon</span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_dict_pca_only.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_dict_pca_only, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>HISTORICAL AVERAGE BENCHMARK</code></pre>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>predictions_historical_avg_pca_only_dict <span class="op">=</span> {}</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>y_true_historical_avg_pca_only_dict <span class="op">=</span> {}</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets2.items():</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    predictions_historical_avg_pca_only_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    y_true_historical_avg_pca_only_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>        y_true_historical_per_pca_only_horizon <span class="op">=</span> []</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>        y_pred_historical_per_pca_only_horizon <span class="op">=</span> []</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute historical average</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>            historical_avg <span class="op">=</span> np.mean(y_train_temp)</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use historical average as prediction</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>            y_pred_temp <span class="op">=</span> np.full(h, historical_avg)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append prediction and true value to lists</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>            y_pred_historical_per_pca_only_horizon.append(y_pred_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>            y_true_historical_per_pca_only_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store predictions and true values for this horizon</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>        predictions_historical_avg_pca_only_dict[model_name][h] <span class="op">=</span> y_pred_historical_per_pca_only_horizon</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>        y_true_historical_avg_pca_only_dict[model_name][h] <span class="op">=</span> y_true_historical_per_pca_only_horizon </span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_historical_avg_pca_only_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_historical_avg_pca_only_dict, f)</span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_true_historical_avg_pca_only_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_true_historical_avg_pca_only_dict, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>AUTOREGRESSIVE BENCHMARK ($AR$) BENCHMARK MODEL</code></pre>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>predictions_ar_pca_only_dict <span class="op">=</span> {}</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>y_true_ar_pca_only_dict <span class="op">=</span> {}</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, (train, test) <span class="kw">in</span> datasets2.items():</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    predictions_ar_pca_only_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    y_true_ar_pca_only_dict[model_name] <span class="op">=</span> {h: [] <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate train and test</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> np.concatenate([train, test])</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>        y_true_per_ar_horizon <span class="op">=</span> []</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>        y_pred_per_ar_horizon <span class="op">=</span> []</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over time points in the test set</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(data) <span class="op">-</span> h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the corresponding targets</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>            y_train_temp <span class="op">=</span> Target[:i]</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>            y_test_temp <span class="op">=</span> Target[i:i<span class="op">+</span>h]</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine the order of the AR model using AIC</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>            AIC <span class="op">=</span> []</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>):  <span class="co"># for simplicity, consider orders up to 10</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>                model_temp <span class="op">=</span> AutoReg(y_train_temp, lags<span class="op">=</span>p, old_names<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>                result_temp <span class="op">=</span> model_temp.fit()</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>                AIC.append(result_temp.aic)</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>            optimal_p <span class="op">=</span> np.argmin(AIC) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fit the AR model of order optimal_p</span></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>            model_ar <span class="op">=</span> AutoReg(y_train_temp, lags<span class="op">=</span>optimal_p, old_names<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>            result_ar <span class="op">=</span> model_ar.fit()</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make a prediction and add it to the predictions list</span></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>            y_pred_temp <span class="op">=</span> result_ar.predict(start<span class="op">=</span><span class="bu">len</span>(y_train_temp), end<span class="op">=</span><span class="bu">len</span>(y_train_temp)<span class="op">+</span>h<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>            y_pred_per_ar_horizon.append(y_pred_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append true value to list</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>            y_true_per_ar_horizon.append(y_test_temp[h<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store predictions and true values for this horizon</span></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>        predictions_ar_pca_only_dict[model_name][h] <span class="op">=</span> y_pred_per_ar_horizon</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>        y_true_ar_pca_only_dict[model_name][h] <span class="op">=</span> y_true_per_ar_horizon </span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dictionaries to files for future use</span></span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'predictions_ar_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>    pickle.dump(predictions_ar_dict, f)</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_true_ar_dict.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_true_ar_dict, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>RELATIVE ROOT MEAN SQUARED ERROR (HISTORICAL AVERAGE)</code></pre>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing RMSFE for each horizon and each model</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>rmsfe_dict_pca_only <span class="op">=</span> {}</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>rrmsfe_dict_pca_only <span class="op">=</span> {}</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    rmsfe_dict_pca_only[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    rrmsfe_dict_pca_only[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSFE for this model and benchmark model</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>        msfe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        msfe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        rmsfe_model <span class="op">=</span> sqrt(msfe_model)</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RRMSFE for this model</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>        rrmsfe_model <span class="op">=</span> sqrt(msfe_model <span class="op">/</span> msfe_benchmark)</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store MSFE and RRMSFE for this horizon</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>        rmsfe_dict_pca_only[model_name][h] <span class="op">=</span> rmsfe_model</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>        rrmsfe_dict_pca_only[model_name][h] <span class="op">=</span> rrmsfe_model</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Relative Root Mean Squared Forecast Errors (RRMSFE) against HA:"</span>)</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, rrmsfe_values <span class="kw">in</span> rrmsfe_dict_pca_only.items():</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, rrmsfe <span class="kw">in</span> rrmsfe_values.items():</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rrmsfe<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .4f is for displaying only up to 4 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Relative Root Mean Squared Forecast Errors (RRMSFE) against HA:

Model: Unigram Features ($D_{5,t}$)
Horizon 1: 1.010
Horizon 3: 1.014
Horizon 6: 1.016
Horizon 9: 1.013

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: 1.006
Horizon 3: 1.007
Horizon 6: 1.008
Horizon 9: 1.008

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: 1.037
Horizon 3: 1.097
Horizon 6: 1.089
Horizon 9: 1.039

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: 1.008
Horizon 3: 1.010
Horizon 6: 1.012
Horizon 9: 1.011</code></pre>
</div>
</div>
<pre><code>RELATIVE ROOT MEAN SQUARED ERROR (AUTOREGRESSIVE MODEL)</code></pre>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing RMSFE for each horizon and each model</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>rmsfe_dict <span class="op">=</span> {}</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>rrmsfe_dict <span class="op">=</span> {}</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    rmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    rrmsfe_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_pca_only_dict[model_name][h])</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_pca_only_dict[model_name][h])</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSFE for this model and benchmark model</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        msfe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>        msfe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>        rmsfe_model <span class="op">=</span> sqrt(msfe_model)</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate RRMSFE for this model</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>        rrmsfe_model <span class="op">=</span> sqrt(msfe_model <span class="op">/</span> msfe_benchmark)</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store MSFE and RRMSFE for this horizon</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>        rmsfe_dict[model_name][h] <span class="op">=</span> rmsfe_model</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>        rrmsfe_dict[model_name][h] <span class="op">=</span> rrmsfe_model</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Relative Root Mean Squared Forecast Errors (RRMSFE) against AR(p):"</span>)</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, rrmsfe_values <span class="kw">in</span> rrmsfe_dict.items():</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, rrmsfe <span class="kw">in</span> rrmsfe_values.items():</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rrmsfe<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .4f is for displaying only up to 4 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Relative Root Mean Squared Forecast Errors (RRMSFE) against AR(p):

Model: Unigram Features ($D_{5,t}$)
Horizon 1: 1.056
Horizon 3: 1.008
Horizon 6: 1.019
Horizon 9: 1.013

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: 1.052
Horizon 3: 1.002
Horizon 6: 1.012
Horizon 9: 1.007

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: 1.085
Horizon 3: 1.092
Horizon 6: 1.093
Horizon 9: 1.038

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: 1.054
Horizon 3: 1.005
Horizon 6: 1.016
Horizon 9: 1.011</code></pre>
</div>
</div>
<pre><code>OUT OF SAMPLE **R^{2}**</code></pre>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing o-o-s R-squared for each horizon and each model</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>r2_oos_dict <span class="op">=</span> {}</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca_only.keys():</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    r2_oos_dict[model_name] <span class="op">=</span> {}</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSPE for the model and benchmark</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>        mspe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>        mspe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate R^2_oos</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>        r2_oos <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (mspe_model <span class="op">/</span> mspe_benchmark))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>        r2_oos_dict[model_name][h] <span class="op">=</span> r2_oos</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Out-of-sample R-squared (OOS-Rsq) against HA:"</span>)</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, oos_values <span class="kw">in</span> r2_oos_dict.items():</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, oos <span class="kw">in</span> oos_values.items():</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>oos<span class="sc">:.2f}</span><span class="ss">"</span>)  <span class="co"># .4f is for displaying only up to 4 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Out-of-sample R-squared (OOS-Rsq) against HA:

Model: Unigram Features ($D_{5,t}$)
Horizon 1: -2.00
Horizon 3: -2.72
Horizon 6: -3.16
Horizon 9: -2.69

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: -1.14
Horizon 3: -1.42
Horizon 6: -1.69
Horizon 9: -1.51

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: -7.58
Horizon 3: -20.38
Horizon 6: -18.55
Horizon 9: -7.90

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: -1.66
Horizon 3: -2.09
Horizon 6: -2.50
Horizon 9: -2.28</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing o-o-s R-squared for each horizon and each model</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>r2_oos_dict <span class="op">=</span> {}</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca_only.keys():</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    r2_oos_dict[model_name] <span class="op">=</span> {}</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_pca_only_dict[model_name][h])</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_pca_only_dict[model_name][h])</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate MSPE for the model and benchmark</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>        mspe_model <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>        mspe_benchmark <span class="op">=</span> np.mean((y_true <span class="op">-</span> y_benchmark)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate R^2_oos</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>        r2_oos <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> (mspe_model <span class="op">/</span> mspe_benchmark))<span class="op">*</span><span class="dv">100</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>        r2_oos_dict[model_name][h] <span class="op">=</span> r2_oos</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Out-of-sample R-squared (OOS-Rsq) against AR(p):"</span>)</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, oos_values <span class="kw">in</span> r2_oos_dict.items():</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, oos <span class="kw">in</span> oos_values.items():</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>oos<span class="sc">:.2f}</span><span class="ss">"</span>)  <span class="co"># .4f is for displaying only up to 4 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Out-of-sample R-squared (OOS-Rsq) against AR(p):

Model: Unigram Features ($D_{5,t}$)
Horizon 1: -11.52
Horizon 3: -1.70
Horizon 6: -3.91
Horizon 9: -2.62

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: -10.59
Horizon 3: -0.41
Horizon 6: -2.43
Horizon 9: -1.44

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: -17.62
Horizon 3: -19.18
Horizon 6: -19.42
Horizon 9: -7.82

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: -11.15
Horizon 3: -1.07
Horizon 6: -3.25
Horizon 9: -2.20</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing DM test results for each horizon and each model</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>dm_test_results_dict <span class="op">=</span> {}</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    dm_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_pca_only_dict[model_name][h])</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_pca_only_dict[model_name][h])</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Diebold-Mariano test</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>        dm_stat, p_value <span class="op">=</span> dm_test(y_true, y_pred, y_benchmark, one_sided <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the DM test results</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>        dm_test_results_dict[model_name][h] <span class="op">=</span> (dm_stat, p_value) <span class="co"># Negative for greater than one-sided</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Diebold-Mariano test results aginst AR(p):"</span>)</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, dm_results <span class="kw">in</span> dm_test_results_dict.items():</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (dm_stat, p_value) <span class="kw">in</span> dm_results.items():</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: DM Statistic: </span><span class="sc">{</span>dm_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Diebold-Mariano test results aginst AR(p):

Model: Unigram Features ($D_{5,t}$)
Horizon 1: DM Statistic: 1.508, p-value: 0.933
Horizon 3: DM Statistic: 0.400, p-value: 0.655
Horizon 6: DM Statistic: 1.270, p-value: 0.897
Horizon 9: DM Statistic: 1.556, p-value: 0.939

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: DM Statistic: 1.421, p-value: 0.921
Horizon 3: DM Statistic: 0.100, p-value: 0.540
Horizon 6: DM Statistic: 0.858, p-value: 0.804
Horizon 9: DM Statistic: 1.085, p-value: 0.860

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: DM Statistic: 1.731, p-value: 0.957
Horizon 3: DM Statistic: 1.776, p-value: 0.961
Horizon 6: DM Statistic: 2.421, p-value: 0.992
Horizon 9: DM Statistic: 2.119, p-value: 0.982

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: DM Statistic: 1.484, p-value: 0.930
Horizon 3: DM Statistic: 0.257, p-value: 0.601
Horizon 6: DM Statistic: 1.100, p-value: 0.863
Horizon 9: DM Statistic: 1.475, p-value: 0.929</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing Clark-West test results for each horizon and each model</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>cw_test_results_dict <span class="op">=</span> {}</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    cw_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_pca_only_dict[model_name][h])</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_pca_only_dict[model_name][h])</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss difference</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> (benchmark_errors <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> (model_errors <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the extra term for Clark-West test</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>        cw_extra_term <span class="op">=</span> (benchmark_errors <span class="op">-</span> model_errors) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Clark-West test</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>        cw_stat <span class="op">=</span> d.mean() <span class="op">/</span> (np.sqrt((d <span class="op">-</span> cw_extra_term).var() <span class="op">/</span> <span class="bu">len</span>(d)))</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since the Clark-West test is one-sided, we take the complement of the cumulative distribution function</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.norm.cdf(cw_stat)</span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the Clark-West test results</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>        cw_test_results_dict[model_name][h] <span class="op">=</span> (cw_stat, p_value)</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Clark-West test results against AR(p):"</span>)</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, cw_results <span class="kw">in</span> cw_test_results_dict.items():</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (cw_stat, p_value) <span class="kw">in</span> cw_results.items():</span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: CW Statistic: </span><span class="sc">{</span>cw_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Clark-West test results against AR(p):

Model: Unigram Features ($D_{5,t}$)
Horizon 1: CW Statistic: -1.387, p-value: 0.917
Horizon 3: CW Statistic: -0.385, p-value: 0.650
Horizon 6: CW Statistic: -1.278, p-value: 0.899
Horizon 9: CW Statistic: -1.522, p-value: 0.936

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: CW Statistic: -1.311, p-value: 0.905
Horizon 3: CW Statistic: -0.097, p-value: 0.539
Horizon 6: CW Statistic: -0.876, p-value: 0.810
Horizon 9: CW Statistic: -1.077, p-value: 0.859

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: CW Statistic: -1.326, p-value: 0.908
Horizon 3: CW Statistic: -1.259, p-value: 0.896
Horizon 6: CW Statistic: -1.862, p-value: 0.969
Horizon 9: CW Statistic: -1.810, p-value: 0.965

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: CW Statistic: -1.366, p-value: 0.914
Horizon 3: CW Statistic: -0.248, p-value: 0.598
Horizon 6: CW Statistic: -1.111, p-value: 0.867
Horizon 9: CW Statistic: -1.448, p-value: 0.926</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing DM test results for each horizon and each model</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>dm_test_results_dict <span class="op">=</span> {}</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    dm_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Diebold-Mariano test</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>        dm_stat, p_value <span class="op">=</span> dm_test(y_true, y_pred, y_benchmark, one_sided <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the DM test results</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>        dm_test_results_dict[model_name][h] <span class="op">=</span> (dm_stat, p_value) <span class="co"># Negative for greater than one-sided</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Diebold-Mariano test results aginst HA:"</span>)</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, dm_results <span class="kw">in</span> dm_test_results_dict.items():</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (dm_stat, p_value) <span class="kw">in</span> dm_results.items():</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: DM Statistic: </span><span class="sc">{</span>dm_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Diebold-Mariano test results aginst HA:

Model: Unigram Features ($D_{5,t}$)
Horizon 1: DM Statistic: 1.176, p-value: 0.879
Horizon 3: DM Statistic: 1.533, p-value: 0.936
Horizon 6: DM Statistic: 1.723, p-value: 0.956
Horizon 9: DM Statistic: 1.492, p-value: 0.931

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: DM Statistic: 0.820, p-value: 0.793
Horizon 3: DM Statistic: 1.009, p-value: 0.843
Horizon 6: DM Statistic: 1.206, p-value: 0.885
Horizon 9: DM Statistic: 1.090, p-value: 0.861

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: DM Statistic: 0.930, p-value: 0.823
Horizon 3: DM Statistic: 2.426, p-value: 0.992
Horizon 6: DM Statistic: 2.809, p-value: 0.997
Horizon 9: DM Statistic: 1.988, p-value: 0.976

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: DM Statistic: 1.068, p-value: 0.856
Horizon 3: DM Statistic: 1.329, p-value: 0.907
Horizon 6: DM Statistic: 1.576, p-value: 0.941
Horizon 9: DM Statistic: 1.444, p-value: 0.925</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing Clark-West test results for each horizon and each model</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>cw_test_results_dict <span class="op">=</span> {}</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over datasets</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, _ <span class="kw">in</span> datasets2.items():</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    cw_test_results_dict[model_name] <span class="op">=</span> {h: <span class="dv">0</span> <span class="cf">for</span> h <span class="kw">in</span> horizons}</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over horizons</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this horizon</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate benchmark predictions (AutoRegressive model)</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the prediction errors</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>        model_errors <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>        benchmark_errors <span class="op">=</span> y_true <span class="op">-</span> y_benchmark</span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss difference</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> (benchmark_errors <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> (model_errors <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the extra term for Clark-West test</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>        cw_extra_term <span class="op">=</span> (benchmark_errors <span class="op">-</span> model_errors) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Clark-West test</span></span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>        cw_stat <span class="op">=</span> d.mean() <span class="op">/</span> (np.sqrt((d <span class="op">-</span> cw_extra_term).var() <span class="op">/</span> <span class="bu">len</span>(d)))</span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Since the Clark-West test is one-sided, we take the complement of the cumulative distribution function</span></span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.norm.cdf(cw_stat)</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the Clark-West test results</span></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>        cw_test_results_dict[model_name][h] <span class="op">=</span> (cw_stat, p_value)</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Clark-West test results against HA:"</span>)</span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name, cw_results <span class="kw">in</span> cw_test_results_dict.items():</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h, (cw_stat, p_value) <span class="kw">in</span> cw_results.items():</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">: CW Statistic: </span><span class="sc">{</span>cw_stat<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span>)  <span class="co"># .3f is for displaying only up to 3 decimal places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Clark-West test results against HA:

Model: Unigram Features ($D_{5,t}$)
Horizon 1: CW Statistic: -1.162, p-value: 0.877
Horizon 3: CW Statistic: -1.507, p-value: 0.934
Horizon 6: CW Statistic: -1.676, p-value: 0.953
Horizon 9: CW Statistic: -1.448, p-value: 0.926

Model: Fixed Dictionary Features ($D_{6,t}$)
Horizon 1: CW Statistic: -0.809, p-value: 0.791
Horizon 3: CW Statistic: -0.992, p-value: 0.839
Horizon 6: CW Statistic: -1.183, p-value: 0.882
Horizon 9: CW Statistic: -1.072, p-value: 0.858

Model: Untargeted FRED-MD Features ($D_{7,t}$)
Horizon 1: CW Statistic: -0.821, p-value: 0.794
Horizon 3: CW Statistic: -1.934, p-value: 0.973
Horizon 6: CW Statistic: -2.317, p-value: 0.990
Horizon 9: CW Statistic: -1.625, p-value: 0.948

Model: Untargeted Features ($D_{8,t}$)
Horizon 1: CW Statistic: -1.059, p-value: 0.855
Horizon 3: CW Statistic: -1.312, p-value: 0.905
Horizon 6: CW Statistic: -1.538, p-value: 0.938
Horizon 9: CW Statistic: -1.410, p-value: 0.921</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of models</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> <span class="bu">list</span>(predictions_dict_pca_only.keys())</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates of the Great Recession (according to NBER)</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>recession_start <span class="op">=</span> pd.to_datetime(<span class="st">'2007-12-01'</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>recession_end <span class="op">=</span> pd.to_datetime(<span class="st">'2009-06-30'</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique horizons</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>n_horizons <span class="op">=</span> <span class="bu">len</span>(horizons)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique models</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid of subplots: n_horizons rows and n_models columns</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(n_horizons, n_models, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span> <span class="op">*</span> n_horizons))</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten array to easily iterate over it in a single loop</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each horizon</span></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> h_idx, h <span class="kw">in</span> <span class="bu">enumerate</span>(horizons):</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each model</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m_idx, model_name <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axs[n_models <span class="op">*</span> h_idx <span class="op">+</span> m_idx]  <span class="co"># Assign subplot position</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get AutoRegressive predictions for this model</span></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_ar_pca_only_dict[model_name][h])</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_ar_pca_only_dict[model_name][h])</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>        e1 <span class="op">=</span> (y_true <span class="op">-</span> y_pred) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from your model</span></span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>        e2 <span class="op">=</span> (y_true <span class="op">-</span> y_benchmark) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from the benchmark model</span></span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate CSPE for the model and benchmark</span></span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>        cspe_model <span class="op">=</span> np.cumsum(e1)</span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>        cspe_benchmark <span class="op">=</span> np.cumsum(e2)</span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust dates based on the horizon</span></span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> oos_base_dates[h<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot CSPE</span></span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>        y_values <span class="op">=</span> cspe_benchmark <span class="op">-</span> cspe_model</span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>        ax.plot(dates, y_values, label<span class="op">=</span><span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a shaded region for the recession</span></span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>        ax.axvspan(recession_start, recession_end, color<span class="op">=</span><span class="st">'silver'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set y-limit such that 0 is in the middle</span></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>        y_abs_max <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(y_values.<span class="bu">min</span>()), <span class="bu">abs</span>(y_values.<span class="bu">max</span>()))</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span>y_abs_max<span class="op">-</span><span class="fl">0.1</span>, y_abs_max<span class="op">+</span><span class="fl">0.1</span>)</span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>        ax.set_title(model_name)</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'pca_ar_cspe.eps'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="main_script_PVAM_files/figure-html/cell-49-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of models</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> <span class="bu">list</span>(predictions_dict_pca_only.keys())</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates of the Great Recession (according to NBER)</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>recession_start <span class="op">=</span> pd.to_datetime(<span class="st">'2007-12-01'</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>recession_end <span class="op">=</span> pd.to_datetime(<span class="st">'2009-06-30'</span>)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique horizons</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>n_horizons <span class="op">=</span> <span class="bu">len</span>(horizons)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of unique models</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid of subplots: n_horizons rows and n_models columns</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(n_horizons, n_models, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">3</span> <span class="op">*</span> n_horizons))</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten array to easily iterate over it in a single loop</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each horizon</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> h_idx, h <span class="kw">in</span> <span class="bu">enumerate</span>(horizons):</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each model</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m_idx, model_name <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axs[n_models <span class="op">*</span> h_idx <span class="op">+</span> m_idx]  <span class="co"># Assign subplot position</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get AutoRegressive predictions for this model</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>        y_benchmark <span class="op">=</span> np.array(predictions_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get true values and predictions for this model and horizon</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> np.array(y_true_historical_avg_pca_only_dict[model_name][h])</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> np.array(predictions_dict_pca_only[model_name][h])</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>        e1 <span class="op">=</span> (y_true <span class="op">-</span> y_pred) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from your model</span></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>        e2 <span class="op">=</span> (y_true <span class="op">-</span> y_benchmark) <span class="op">**</span> <span class="dv">2</span>  <span class="co"># forecast errors from the benchmark model</span></span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate CSPE for the model and benchmark</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>        cspe_model <span class="op">=</span> np.cumsum(e1)</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>        cspe_benchmark <span class="op">=</span> np.cumsum(e2)</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust dates based on the horizon</span></span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> oos_base_dates[h<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot CSPE</span></span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>        y_values <span class="op">=</span> cspe_benchmark <span class="op">-</span> cspe_model</span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>        ax.plot(dates, y_values, label<span class="op">=</span><span class="ss">f'Horizon </span><span class="sc">{</span>h<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a shaded region for the recession</span></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>        ax.axvspan(recession_start, recession_end, color<span class="op">=</span><span class="st">'silver'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set y-limit such that 0 is in the middle</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>        y_abs_max <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(y_values.<span class="bu">min</span>()), <span class="bu">abs</span>(y_values.<span class="bu">max</span>()))</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span>y_abs_max<span class="op">-</span><span class="fl">0.1</span>, y_abs_max<span class="op">+</span><span class="fl">0.1</span>)</span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>        ax.set_title(model_name)</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'pca_ha_cspe.eps'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="main_script_PVAM_files/figure-html/cell-50-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>forecast_records <span class="op">=</span> []</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>true_records <span class="op">=</span> []</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca.keys():</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retrieve forecasts for each horizon for current model</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>        forecasts <span class="op">=</span> predictions_dict_pca[model_name][h]</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>        forecasts_ar <span class="op">=</span> predictions_ar_dict[model_name][h]</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>        forecasts_ha <span class="op">=</span> predictions_historical_avg_dict[model_name][h]</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retrieve true values for each horizon for current model</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>        true_values <span class="op">=</span> y_true_dict_pca[model_name][h]</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over each forecast and true value and create a new record for each</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(forecasts)):</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>            forecast_record <span class="op">=</span> {</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model'</span>: model_name,</span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Horizon'</span>: h,</span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast'</span>: forecasts[i],</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast_AR'</span>: forecasts_ar[i],</span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast_HA'</span>: forecasts_ha[i]</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>            true_record <span class="op">=</span> {</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model'</span>: model_name,</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Horizon'</span>: h,</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TrueValue'</span>: true_values[i]</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append the record to list</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a>            forecast_records.append(forecast_record)</span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a>            true_records.append(true_record)</span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrames</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> pd.DataFrame(forecast_records)</span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a>true_df <span class="op">=</span> pd.DataFrame(true_records)</span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Save DataFrames to .csv files</span></span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a>forecast_df.to_csv(<span class="st">'forecasts.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a>true_df.to_csv(<span class="st">'true_values.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder for storing all values for each horizon and each model</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>forecast_records <span class="op">=</span> []</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>true_records <span class="op">=</span> []</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each model</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model_name <span class="kw">in</span> predictions_dict_pca_only.keys():</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each horizon</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> horizons:</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retrieve forecasts for each horizon for current model</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>        forecasts <span class="op">=</span> predictions_dict_pca_only[model_name][h]</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>        forecasts_ar <span class="op">=</span> predictions_ar_pca_only_dict[model_name][h]</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>        forecasts_ha <span class="op">=</span> predictions_historical_avg_pca_only_dict[model_name][h]</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retrieve true values for each horizon for current model</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>        true_values <span class="op">=</span> y_true_dict_pca_only[model_name][h]</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop over each forecast and true value and create a new record for each</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(forecasts)):</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>            forecast_record <span class="op">=</span> {</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model'</span>: model_name,</span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Horizon'</span>: h,</span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast'</span>: forecasts[i],</span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast_AR'</span>: forecasts_ar[i],</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Forecast_HA'</span>: forecasts_ha[i]</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>            true_record <span class="op">=</span> {</span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Model'</span>: model_name,</span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Horizon'</span>: h,</span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TrueValue'</span>: true_values[i]</span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append the record to list</span></span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>            forecast_records.append(forecast_record)</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>            true_records.append(true_record)</span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrames</span></span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> pd.DataFrame(forecast_records)</span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>true_df <span class="op">=</span> pd.DataFrame(true_records)</span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Save DataFrames to .csv files</span></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>forecast_df.to_csv(<span class="st">'forecasts_pca_only.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>true_df.to_csv(<span class="st">'true_values_pca_only.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>